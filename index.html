<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Poke House ‚Äì Treino v5.00</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'Segoe UI', 'Roboto', 'sans-serif'],
                    },
                    colors: {
                        'ph-blue': '#E0F2FF',
                        'ph-pink': '#FFE6F2',
                        'ph-green': '#A7F3D0',
                        'ph-yellow': '#FEF9C3',
                        'glass-white': 'rgba(255, 255, 255, 0.7)',
                    },
                    animation: {
                        'bounce-subtle': 'bounceSubtle 2s infinite',
                        'fade-in': 'fadeIn 0.4s ease-out forwards',
                        'slide-up': 'slideUp 0.5s ease-out forwards',
                    },
                    keyframes: {
                        bounceSubtle: {
                            '0%, 100%': { transform: 'translateY(-3%)' },
                            '50%': { transform: 'translateY(0)' }
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        }
                    }
                }
            }
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        body { margin: 0; overflow: hidden; background: linear-gradient(135deg, #fdfbf7 0%, #eef2ff 100%); touch-action: manipulation; font-family: 'Segoe UI', sans-serif; }
        .glass-panel { background: rgba(255, 255, 255, 0.65); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.5); }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- √çCONES (Lucide Style) ---
        const Icon = ({ path, size = 20, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {path}
            </svg>
        );
        const Icons = {
            Home: <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/>,
            ArrowLeft: <><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></>,
            ArrowRight: <><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></>,
            Rotate: <><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></>,
            Check: <polyline points="20 6 9 17 4 12"/>,
            List: <><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></>
        };

        // --- DADOS ---
        const SUCCESS_MESSAGES = ["Ficou perfeita! ü§©", "Estudou direitinho ein! ‚úÖ", "Ficou igualzinha ao SOP! üìö", "Que mente de tit√¢nio! üß†"];
        const FAIL_MESSAGES = ["Algo n√£o t√° legal. ü§®", "O cliente vai reclamar. ü§¶üèª‚Äç‚ôÇÔ∏è", "Precisamos revisar o SOP. üìö"];
        const PA_NAMES = { MALE: ["Pedro", "Paulo", "Francisco", "Heitor", "Marcelo", "Jos√©"], FEMALE: ["In√™s", "Eliz", "Melissa", "Mariana", "Vilma", "Bruna"] };
        const PA_EMOJIS = { MALE: ["üë®", "üßîüèª", "üë®üèø", "üë®üèø‚Äçü¶∞"], FEMALE: ["üë©üèª", "üë©üèª‚Äçü¶∞", "üë©üèø", "üë©"] };
        const FINAL_CUSTOM_PHRASES = ["Uau! Ficou linda sua bowl!", "Bom apetite!", "Prontinho! Experimente um dos nosso sumos naturais.", "Seu rosto √© fam√≠liar, j√° √© nosso cliente n√©?", "Muito obrigado, volte mais vezes!"];

        const CHANGELOG = [
            { version: "5.00", date: "Atual", changes: ["Redesign completo: Estilo Minimalista/Windows 11.", "Remo√ß√£o do canvas do oceano para otimiza√ß√£o m√°xima.", "Mantido apenas o easter egg da salada (mobile)."] },
            { version: "4.06", date: "Anterior", changes: ["Otimiza√ß√£o de Performance."] },
            { version: "4.05", date: "Anterior", changes: ["Ajuste visual: Anima√ß√£o suave nos bot√µes."] },
            { version: "4.0", date: "Anterior", changes: ["Novo Modo: 'Crie sua pr√≥pria bowl' (Roleplay)."] }
        ];

        const INGREDIENTS_DB = {
            sizes: ["Regular", "Large"],
            bases: ["Arroz de sushi", "Arroz preto", "Quinoa", "Arroz basmati", "Coconut Basmati", "Espinafres", "Winter Salad"],
            sauces_base: ["Azeite", "Azeite de Lim√£o", "Vinagrete", "Ponzu", "Sriracha Mayo", "N√£o leva"],
            greens: ["Batata Doce com Alecrim", "Br√≥colis", "Pickle Cebola", "Beterraba", "Cenoura c/ Soja", "Milho", "Abacaxi", "Edamame", "Tomate Cherry", "Couve roxa", "Courgette", "Cenoura", "Grana Padano", "Pepino", "Feta", "Jalape√±os", "Azeitonas", "Abacate", "Philadelphia", "Wakame", "Manga", "Hummus", "Hortel√£ (Fresca)"],
            proteins: ["Salm√£o Braseado", "Fil√© de Salm√£o", "Frango Vietnamita", "Camar√£o Panado", "Frango", "Frango Teriyaki", "Camar√£o", "Juicy Salmon", "Juicy Tuna", "Salm√£o", "Atum", "Tofu Grelhado", "Ovo", "N√£o leva", "Wakame"],
            sauces_final: ["Creamy Caesar", "Creme de Abacate", "Spicy Peanuts", "Mel", "Chipotle", "S√©samo Shoyu", "Sriracha Mayo", "Wasabi Mayo", "Azeite", "Azeite de Lim√£o", "Manjeric√£o e Hortel√£", "Vinagrete", "Soja", "Teriyaki", "Ponzu", "Especial", "Soja e S√©samo"],
            crispies: ["Cebola frita", "Ervilhas Wasabi", "Algas Nori", "Am√™ndoa", "Batata Doce", "Lima", "Bacon", "Croutons", "Batata Doce Crocante", "N√£o leva", "Cebola Crocante"],
            sesame: ["Sim", "N√£o"],
            smoothie_liquid: ["Leite de Coco", "Leite", "Suco de Ma√ß√£"],
            smoothie_amount: ["150ml", "250ml", "200ml"],
            smoothie_ingredients: ["Morango", "Banana 90g", "Manga 40g", "Anan√°s 30g", "Pepino 20g", "Abacate 45g", "Espinafre 30g", "Sumo de Lima 25g", "Gengibre 5g"],
            smoothie_ice: ["Gelo 60g", "Gelo 40g", "Gelo 90g"],
            smoothie_mode: ["Modo A", "Modo B", "Modo C", "Modo D", "Modo E", "Modo F"]
        };

        // LISTA DE RECEITAS (Mantida Completa)
        const RECIPES = [
             { id: 1, category: "HOUSE", name: "Sunny Salmon üåû", variants: { "Regular": { base: ["Arroz de sushi", "Arroz de sushi"], sauce_base: ["N√£o leva"], greens: ["Abacate", "Couve roxa", "Edamame"], protein: ["Juicy Salmon", "Juicy Salmon"], sauce_final: ["Especial", "Creme de Abacate"], crispy: ["N√£o leva"], sesame: ["Sim"] }, "Large": { base: ["Arroz de sushi", "Arroz de sushi", "Arroz de sushi"], sauce_base: ["N√£o leva"], greens: ["Abacate", "Couve roxa", "Couve roxa", "Edamame", "Edamame"], protein: ["Juicy Salmon", "Juicy Salmon", "Juicy Salmon"], sauce_final: ["Especial", "Creme de Abacate"], crispy: ["N√£o leva"], sesame: ["Sim"] } } },
             { id: 2, category: "HOUSE", name: "Spicy Tuna üêü", variants: { "Regular": { base: ["Arroz de sushi", "Arroz de sushi"], sauce_base: ["N√£o leva"], greens: ["Couve roxa", "Pepino", "Cenoura"], protein: ["Atum", "Atum", "Wakame"], sauce_final: ["Ponzu", "Spicy Peanuts"], crispy: ["Cebola frita"], sesame: ["Sim"] }, "Large": { base: ["Arroz de sushi", "Arroz de sushi", "Arroz de sushi"], sauce_base: ["N√£o leva"], greens: ["Couve roxa", "Couve roxa", "Pepino", "Pepino", "Cenoura"], protein: ["Atum", "Atum", "Atum", "Wakame"], sauce_final: ["Ponzu", "Spicy Peanuts"], crispy: ["Cebola frita"], sesame: ["Sim"] } } },
             { id: 3, category: "HOUSE", name: "Vegetarian üåø", variants: { "Regular": { base: ["Arroz basmati", "Arroz basmati"], sauce_base: ["N√£o leva"], greens: ["Abacate", "Hummus", "Hummus", "Tomate Cherry", "Pepino", "Azeitonas"], protein: ["N√£o leva"], sauce_final: ["Manjeric√£o e Hortel√£"], crispy: ["Am√™ndoa"], sesame: ["N√£o"] }, "Large": { base: ["Arroz basmati", "Arroz basmati", "Arroz basmati"], sauce_base: ["N√£o leva"], greens: ["Abacate", "Hummus", "Hummus", "Hummus", "Tomate Cherry", "Pepino", "Azeitonas", "Azeitonas"], protein: ["N√£o leva"], sauce_final: ["Manjeric√£o e Hortel√£"], crispy: ["Am√™ndoa"], sesame: ["N√£o"] } } },
             { id: 4, category: "HOUSE", name: "Chicken üêî", variants: { "Regular": { base: ["Arroz de sushi", "Arroz de sushi"], sauce_base: ["N√£o leva"], greens: ["Couve roxa", "Tomate Cherry", "Courgette"], protein: ["Frango Teriyaki", "Frango Teriyaki"], sauce_final: ["Teriyaki", "Sriracha Mayo"], crispy: ["Am√™ndoa"], sesame: ["Sim"] }, "Large": { base: ["Arroz de sushi", "Arroz de sushi", "Arroz de sushi"], sauce_base: ["N√£o leva"], greens: ["Couve roxa", "Couve roxa", "Tomate Cherry", "Courgette", "Courgette"], protein: ["Frango Teriyaki", "Frango Teriyaki", "Frango Teriyaki"], sauce_final: ["Teriyaki", "Sriracha Mayo"], crispy: ["Am√™ndoa"], sesame: ["Sim"] } } },
             { id: 5, category: "HOUSE", name: "Fire Salmon üî•", variants: { "Regular": { base: ["Arroz de sushi", "Arroz de sushi"], sauce_base: ["Sriracha Mayo"], greens: ["Jalape√±os", "Tomate Cherry", "Pepino"], protein: ["Salm√£o", "Salm√£o"], sauce_final: ["Sriracha Mayo"], crispy: ["Cebola frita"], sesame: ["Sim"] }, "Large": { base: ["Arroz de sushi", "Arroz de sushi", "Arroz de sushi"], sauce_base: ["Sriracha Mayo"], greens: ["Jalape√±os", "Tomate Cherry", "Pepino", "Pepino"], protein: ["Salm√£o", "Salm√£o", "Salm√£o"], sauce_final: ["Sriracha Mayo"], crispy: ["Cebola frita"], sesame: ["Sim"] } } },
             { id: 6, category: "HOUSE", name: "Mixed Seas üåä", variants: { "Regular": { base: ["Arroz de sushi", "Arroz de sushi"], sauce_base: ["N√£o leva"], greens: ["Manga", "Wakame", "Cenoura", "Pickle Cebola"], protein: ["Atum", "Salm√£o"], sauce_final: ["Ponzu"], crispy: ["Ervilhas Wasabi"], sesame: ["Sim"] }, "Large": { base: ["Arroz de sushi", "Arroz de sushi", "Arroz de sushi"], sauce_base: ["N√£o leva"], greens: ["Manga", "Wakame", "Cenoura", "Cenoura", "Pickle Cebola"], protein: ["Atum", "Salm√£o", "Salm√£o"], sauce_final: ["Ponzu"], crispy: ["Ervilhas Wasabi"], sesame: ["Sim"] } } },
             { id: 7, category: "HOUSE", name: "Crispy Shrimp ü¶ê", variants: { "Regular": { base: ["Arroz de sushi", "Arroz de sushi"], sauce_base: ["N√£o leva"], greens: ["Abacate", "Philadelphia", "Manga", "Pepino"], protein: Array(8).fill("Camar√£o Panado"), sauce_final: ["Teriyaki", "Sriracha Mayo"], crispy: ["Algas Nori"], sesame: ["Sim"] }, "Large": { base: ["Arroz de sushi", "Arroz de sushi", "Arroz de sushi"], sauce_base: ["N√£o leva"], greens: ["Abacate", "Philadelphia", "Manga", "Pepino", "Pepino"], protein: Array(12).fill("Camar√£o Panado"), sauce_final: ["Teriyaki", "Sriracha Mayo"], crispy: ["Algas Nori"], sesame: ["Sim"] } } },
             { id: 8, category: "HOUSE", name: "Salmon Sushi üç£", variants: { "Regular": { base: ["Arroz de sushi", "Arroz de sushi"], sauce_base: ["N√£o leva"], greens: ["Abacate", "Philadelphia", "Edamame"], protein: ["Salm√£o Braseado", "Salm√£o Braseado"], sauce_final: ["Teriyaki"], crispy: ["Cebola Crocante"], sesame: ["Sim"] }, "Large": { base: ["Arroz de sushi", "Arroz de sushi", "Arroz de sushi"], sauce_base: ["N√£o leva"], greens: ["Abacate", "Philadelphia", "Edamame", "Edamame"], protein: ["Salm√£o Braseado", "Salm√£o Braseado", "Salm√£o Braseado"], sauce_final: ["Teriyaki"], crispy: ["Cebola Crocante"], sesame: ["Sim"] } } },
             { id: 9, category: "GREEN", name: "The Caesar ü•ó", variants: { "Regular": { base: ["Winter Salad", "Winter Salad", "Winter Salad"], sauce_base: ["Vinagrete"], greens: ["Tomate Cherry", "Tomate Cherry", "Grana Padano"], protein: ["Frango", "Frango", "Frango"], sauce_final: ["Creamy Caesar"], crispy: ["Bacon", "Croutons", "Lima"], sesame: ["N√£o"] } } },
             { id: 10, category: "GREEN", name: "Exotic Salmon ü•ó", variants: { "Regular": { base: ["Coconut Basmati", "Espinafres", "Espinafres", "Espinafres"], sauce_base: ["Azeite de Lim√£o"], greens: ["Batata Doce com Alecrim", "Batata Doce com Alecrim", "Br√≥colis", "Abacate"], protein: ["Fil√© de Salm√£o", "Fil√© de Salm√£o", "Fil√© de Salm√£o"], sauce_final: ["Sriracha Mayo"], crispy: ["N√£o leva"], sesame: ["N√£o"] } } },
             { id: 11, category: "GREEN", name: "Velvet Garden ü•ó", variants: { "Regular": { base: ["Winter Salad", "Winter Salad", "Winter Salad"], sauce_base: ["Vinagrete"], greens: ["Cenoura c/ Soja", "Beterraba", "Azeitonas", "Pickle Cebola", "Feta", "Feta", "Feta"], protein: ["N√£o leva"], sauce_final: ["Manjeric√£o e Hortel√£"], crispy: ["N√£o leva"], sesame: ["N√£o"] } } },
             { id: 12, category: "GREEN", name: "Cozy Chicken ü•ó", variants: { "Regular": { base: ["Coconut Basmati", "Espinafres", "Espinafres"], sauce_base: ["Azeite de Lim√£o"], greens: ["Br√≥colis", "Batata Doce com Alecrim", "Couve roxa", "Courgette"], protein: ["Frango Vietnamita", "Frango Vietnamita", "Frango Vietnamita"], sauce_final: ["Soja"], crispy: ["N√£o leva"], sesame: ["N√£o"] } } },
             { id: 13, category: "SMOOTHIE", name: "Into the Sun üíõ", smoothie_liquid: ["Leite de Coco"], smoothie_amount: ["150ml"], smoothie_ingredients: ["Manga 40g", "Manga 40g", "Anan√°s 30g", "Anan√°s 30g", "Banana 90g"], smoothie_ice: ["Gelo 60g"], smoothie_mode: ["Modo E", "Modo E"] },
             { id: 14, category: "SMOOTHIE", name: "Sweet Pink ü©∑", smoothie_liquid: ["Leite"], smoothie_amount: ["150ml"], smoothie_ingredients: ["Morango", "Morango", "Morango", "Morango", "Banana 90g"], smoothie_ice: ["Gelo 60g"], smoothie_mode: ["Modo E", "Modo E"] },
             { id: 15, category: "SMOOTHIE", name: "So Green üíö", smoothie_liquid: ["Suco de Ma√ß√£"], smoothie_amount: ["250ml"], smoothie_ingredients: ["Pepino 20g", "Abacate 45g", "Espinafre 30g", "Sumo de Lima 25g", "Gengibre 5g"], smoothie_ice: ["Gelo 60g"], smoothie_mode: ["Modo E", "Modo E"] }
        ];

        const PHASES_BOWL = [{ key: "size", title: "1Ô∏è‚É£ ‚Äì Tamanho:", hint: "" }, { key: "base", title: "2Ô∏è‚É£ ‚Äì Base:", hint: "" }, { key: "sauce_base", title: "3Ô∏è‚É£ ‚Äì Molho da base:", hint: "" }, { key: "greens", title: "4Ô∏è‚É£ ‚Äì Greens:", hint: "" }, { key: "protein", title: "5Ô∏è‚É£ ‚Äì Prote√≠na:", hint: "" }, { key: "sauce_final", title: "6Ô∏è‚É£ ‚Äì Molho final:", hint: "" }, { key: "crispy", title: "7Ô∏è‚É£ ‚Äì Crispy:", hint: "" }, { key: "sesame", title: "8Ô∏è‚É£ ‚Äì S√©samo:", hint: "" }];
        const PHASES_SMOOTHIE = [{ key: "smoothie_liquid", title: "1Ô∏è‚É£ ‚Äì L√≠quido:", hint: "" }, { key: "smoothie_amount", title: "2Ô∏è‚É£ ‚Äì Quantidade:", hint: "" }, { key: "smoothie_ingredients", title: "3Ô∏è‚É£ ‚Äì Ingredientes:", hint: "" }, { key: "smoothie_ice", title: "4Ô∏è‚É£ ‚Äì Gelo:", hint: "" }, { key: "smoothie_mode", title: "5Ô∏è‚É£ ‚Äì Blender:", hint: "" }];

        const playSound = (type) => { const AudioContext = window.AudioContext || window.webkitAudioContext; if (!AudioContext) return; const ctx = new AudioContext(); const osc = ctx.createOscillator(); const gain = ctx.createGain(); osc.connect(gain); gain.connect(ctx.destination); const now = ctx.currentTime; if (type === "happy") { osc.type = "sine"; osc.frequency.setValueAtTime(600, now); osc.frequency.exponentialRampToValueAtTime(1200, now + 0.1); gain.gain.setValueAtTime(0.1, now); gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1); osc.start(); osc.stop(now + 0.1); } else { osc.type = "sawtooth"; osc.frequency.setValueAtTime(300, now); osc.frequency.linearRampToValueAtTime(150, now + 0.3); gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0.01, now + 0.3); osc.start(); osc.stop(now + 0.3); } };
        function shuffleArray(array) { let currentIndex = array.length, randomIndex; while (currentIndex != 0) { randomIndex = Math.floor(Math.random() * currentIndex); currentIndex--; [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]]; } return array; }

        // --- FOOD RAIN (√öNICO EASTER EGG MANTIDO) ---
        const EASTER_EGG_EMOJIS = ['ü•ë','üçÖ','ü´õ','ü•ï','ü´í','üåΩ','üßÖ','ü•¶','üçì','ü•≠','üçç','üç£','üç§','üç™','ü•ó','üßÄ','ü•ö','ü•î'];
        const FoodRain = React.memo(({ active, trigger, quantity = 1 }) => {
            const canvasRef = React.useRef(null);
            const particlesRef = React.useRef([]);
            
            React.useEffect(() => {
                if (!trigger || trigger === 0) return;
                const canvas = canvasRef.current; if (!canvas) return;
                const newParticles = [];
                for (let i = 0; i < quantity; i++) {
                    const floorY = canvas.height - (Math.random() * (canvas.height * 0.1));
                    newParticles.push({ x: canvas.width / 2, y: canvas.height * 0.4, vx: (Math.random() - 0.5) * 25, vy: (Math.random() - 0.5) * 25, gravity: 0.5, friction: 0.99, elasticity: 0.8, emoji: EASTER_EGG_EMOJIS[Math.floor(Math.random() * EASTER_EGG_EMOJIS.length)], size: 30 + Math.random() * 20, floorY: floorY, life: 1.0, settled: false });
                }
                particlesRef.current = [...particlesRef.current, ...newParticles];
            }, [trigger, quantity]);

            React.useEffect(() => {
                const canvas = canvasRef.current; const ctx = canvas.getContext("2d");
                const resize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
                window.addEventListener("resize", resize); resize();
                let animId;
                const render = () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    particlesRef.current = particlesRef.current.filter(p => p.life > 0);
                    particlesRef.current.forEach(p => {
                        if (!p.settled) { p.vy += p.gravity; p.x += p.vx; p.y += p.vy; if (p.x < 0 || p.x > canvas.width) { p.vx *= -1; p.x = p.x < 0 ? 0 : canvas.width; } if (p.y > p.floorY) { p.y = p.floorY; p.vy *= -p.elasticity; p.vx *= 0.9; if (Math.abs(p.vy) < 1 && Math.abs(p.vx) < 1) p.settled = true; } } else { p.life -= 0.01; }
                        ctx.globalAlpha = Math.max(0, p.life); ctx.font = `${p.size}px sans-serif`; ctx.fillText(p.emoji, p.x, p.y); ctx.globalAlpha = 1.0;
                    });
                    animId = requestAnimationFrame(render);
                };
                render();
                return () => { window.removeEventListener("resize", resize); cancelAnimationFrame(animId); };
            }, []);
            return <canvas ref={canvasRef} className="fixed inset-0 w-full h-full pointer-events-none z-50" />;
        });

        // --- COMPONENTES VISUAIS ---
        const MessageBubble = React.memo(({ text }) => (
            <div className="font-sans text-slate-700 text-lg leading-relaxed bg-white p-5 rounded-2xl shadow-sm border border-slate-100 animate-slide-up">
                {text}
            </div>
        ));

        const TypewriterMessage = React.memo(({ text }) => {
             // Simplificado para aparecer direto, melhor leitura
            return <MessageBubble text={text} />;
        });

        const PopupModal = React.memo(({ message, onConfirm }) => (
            <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/20 backdrop-blur-sm animate-fade-in">
                <div className="bg-white p-6 rounded-2xl shadow-2xl border border-slate-100 max-w-sm w-full mx-4 text-center transform scale-100 animate-bounce-in">
                    <p className="text-lg font-medium text-slate-700 mb-6">{message}</p>
                    <button onClick={onConfirm} className="bg-ph-green text-slate-800 px-6 py-2 rounded-lg font-bold hover:bg-green-300 transition-colors">
                        Entendido
                    </button>
                </div>
            </div>
        ));

        const ChangelogModal = React.memo(({ onClose }) => (
            <div className="fixed inset-0 z-[60] bg-black/30 flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in">
                <div className="bg-white rounded-xl p-6 max-w-md w-full max-h-[80vh] overflow-y-auto shadow-2xl relative border border-slate-100">
                    <button onClick={onClose} className="absolute top-4 right-4 text-slate-400 hover:text-slate-600"><Icon path={Icons.ArrowLeft} size={20} /></button>
                    <h3 className="font-bold text-xl mb-6 text-slate-800 flex items-center gap-2"><Icon path={Icons.List} /> Hist√≥rico de Vers√µes</h3>
                    <div className="space-y-6">{CHANGELOG.map((item, index) => (<div key={index} className="border-l-4 border-slate-200 pl-4"><div className="flex justify-between items-baseline mb-1"><span className="font-bold text-base text-slate-800">v{item.version}</span><span className="text-xs font-semibold text-slate-400 uppercase tracking-wide">{item.date}</span></div><ul className="list-disc list-inside text-sm text-slate-500 space-y-1">{item.changes.map((change, i) => (<li key={i}>{change}</li>))}</ul></div>))}</div>
                    <div className="mt-8 pt-4 border-t border-slate-100 text-center"><button onClick={onClose} className="bg-slate-100 text-slate-600 px-6 py-2 rounded-lg font-bold text-sm hover:bg-slate-200 transition-colors">Fechar</button></div>
                </div>
            </div>
        ));

        // --- APP PRINCIPAL ---
        function App() {
            const [gameState, setGameState] = React.useState("HOME");
            const [menuCategory, setMenuCategory] = React.useState(null); 
            const [selectedRecipe, setSelectedRecipe] = React.useState(null);
            const [selectedSize, setSelectedSize] = React.useState(null); 
            const [currentPhaseIndex, setCurrentPhaseIndex] = React.useState(0);
            const [currentSelections, setCurrentSelections] = React.useState([]);
            const [allSelections, setAllSelections] = React.useState({});
            const [phaseOptions, setPhaseOptions] = React.useState([]);
            const [timer, setTimer] = React.useState(20);
            const [timerEmoji, setTimerEmoji] = React.useState("üòÉ");
            const [errorDetails, setErrorDetails] = React.useState([]);
            const [showChangelog, setShowChangelog] = React.useState(false);
            const [resultMessage, setResultMessage] = React.useState("");
            
            const [customPhase, setCustomPhase] = React.useState(0);
            const [paPersona, setPaPersona] = React.useState({ name: "", emoji: "" });
            const [showPopup, setShowPopup] = React.useState(null);
            const [easterEggTrigger, setEasterEggTrigger] = React.useState(0);

            const handleEasterEggClick = React.useCallback(() => { if (window.innerWidth < 768 && window.innerHeight > window.innerWidth) { setEasterEggTrigger(prev => prev + 1); } }, []);

            const getCurrentPhases = React.useCallback(() => { if (selectedRecipe?.category === "SMOOTHIE") return PHASES_SMOOTHIE; return PHASES_BOWL; }, [selectedRecipe]);
            const getFullIngredientList = (key) => { if(key === 'base') return INGREDIENTS_DB.bases; if(key === 'sauce_base') return INGREDIENTS_DB.sauces_base; if(key === 'greens') return INGREDIENTS_DB.greens; if(key === 'protein') return INGREDIENTS_DB.proteins; if(key === 'sauce_final') return INGREDIENTS_DB.sauces_final; if(key === 'crispy') return INGREDIENTS_DB.crispies; if(key === 'sesame') return INGREDIENTS_DB.sesame; if(key === 'smoothie_liquid') return INGREDIENTS_DB.smoothie_liquid; if(key === 'smoothie_amount') return INGREDIENTS_DB.smoothie_amount; if(key === 'smoothie_ingredients') return INGREDIENTS_DB.smoothie_ingredients; if(key === 'smoothie_ice') return INGREDIENTS_DB.smoothie_ice; if(key === 'smoothie_mode') return INGREDIENTS_DB.smoothie_mode; return []; };
            const getCurrentPhaseData = () => { if(!selectedRecipe) return {}; const phases = getCurrentPhases(); return phases[currentPhaseIndex]; };
            const getSelectionLimit = () => { if (!selectedRecipe) return 0; const phaseKey = getCurrentPhases()[currentPhaseIndex].key; if (phaseKey === "size") return 1; if (selectedRecipe.category === "SMOOTHIE") { return selectedRecipe[phaseKey].length; } else { const sizeToUse = selectedSize || "Regular"; return selectedRecipe.variants[sizeToUse] ? selectedRecipe.variants[sizeToUse][phaseKey].length : 0; } };

            React.useEffect(() => { if (gameState === "PLAYING") { if (timer > 16) setTimerEmoji("üòÉ"); else if (timer > 12) setTimerEmoji("üôÇ"); else if (timer > 8) setTimerEmoji("üòê"); else if (timer > 4) setTimerEmoji("üò¶"); else setTimerEmoji("üò±"); if (timer === 0) { handleGameOver(false, ["Tempo esgotado!"]); return; } const interval = setInterval(() => setTimer(t => t - 1), 1000); return () => clearInterval(interval); } }, [timer, gameState]);
            
            React.useEffect(() => {
                if (gameState === "PLAYING" && selectedRecipe) {
                    const activePhases = getCurrentPhases(); const phaseKey = activePhases[currentPhaseIndex].key;
                    if (phaseKey === "size") { setPhaseOptions(INGREDIENTS_DB.sizes); return; }
                    let fullList = getFullIngredientList(phaseKey);
                    let requiredIngs = [];
                    if (selectedRecipe.category === "SMOOTHIE") { requiredIngs = selectedRecipe[phaseKey]; } else { const sizeToUse = selectedSize || "Regular"; if (selectedRecipe.variants && selectedRecipe.variants[sizeToUse]) { requiredIngs = selectedRecipe.variants[sizeToUse][phaseKey]; } else { requiredIngs = []; } }
                    const requiredSet = new Set(requiredIngs); const requiredUnique = [...requiredSet]; const distractors = fullList.filter(ing => !requiredSet.has(ing)); const shuffledDistractors = shuffleArray([...distractors]); const slotsNeeded = Math.max(0, 9 - requiredUnique.length); const selectedDistractors = shuffledDistractors.slice(0, slotsNeeded); const finalOptions = shuffleArray([...requiredUnique, ...selectedDistractors]);
                    setPhaseOptions(finalOptions);
                }
            }, [currentPhaseIndex, gameState, selectedRecipe, selectedSize]);

            const startGame = (recipe) => { setSelectedRecipe(recipe); setGameState("PLAYING"); if (recipe.category === "GREEN") { setSelectedSize("Regular"); setCurrentPhaseIndex(1); } else if (recipe.category === "SMOOTHIE") { setSelectedSize(null); setCurrentPhaseIndex(0); } else { setSelectedSize(null); setCurrentPhaseIndex(0); } setCurrentSelections([]); setAllSelections({}); setTimer(20); };
            const resetToHome = () => { setGameState("HOME"); setMenuCategory(null); setSelectedRecipe(null); setSelectedSize(null); };
            const handleSelection = (ingredient) => {
                const activePhases = getCurrentPhases(); const phaseKey = activePhases[currentPhaseIndex].key;
                if (phaseKey === "size") { setSelectedSize(ingredient); setCurrentPhaseIndex(prev => prev + 1); setTimer(20); return; }
                setTimer(20);
                let requiredList = []; if (selectedRecipe.category === "SMOOTHIE") { requiredList = selectedRecipe[phaseKey]; } else { const sizeToUse = selectedSize || "Regular"; requiredList = selectedRecipe.variants[sizeToUse][phaseKey]; }
                const isCorrect = requiredList.includes(ingredient); playSound(isCorrect ? "happy" : "sad");
                const newSelections = [...currentSelections, ingredient]; setCurrentSelections(newSelections);
                if (newSelections.length === requiredList.length) {
                    const updatedAll = { ...allSelections, [phaseKey]: newSelections }; setAllSelections(updatedAll);
                    if (currentPhaseIndex < activePhases.length - 1) { setTimeout(() => { setCurrentPhaseIndex(prev => prev + 1); setCurrentSelections([]); setTimer(20); }, 300); } else { validateGame(updatedAll); }
                }
            };
            const handleUndo = () => { if (currentSelections.length > 0) { const newSel = [...currentSelections]; newSel.pop(); setCurrentSelections(newSel); } };
            const validateGame = (finalSelections) => { let errors = []; const activePhases = getCurrentPhases(); const phasesToValidate = activePhases.filter(p => p.key !== "size"); phasesToValidate.forEach(phase => { let required = []; if (selectedRecipe.category === "SMOOTHIE") { required = selectedRecipe[phase.key]; } else { const sizeToUse = selectedSize || "Regular"; required = selectedRecipe.variants[sizeToUse][phase.key]; } const requiredSorted = [...required].sort(); const selectedSorted = [...finalSelections[phase.key]].sort(); if (JSON.stringify(requiredSorted) !== JSON.stringify(selectedSorted)) { errors.push(`Erro em ${phase.title.replace(":", "")}. Era: ${requiredSorted.join(", ")}`); } }); if (errors.length === 0 && window.gtag) { window.gtag('event', 'bowl_concluida', { 'recipe_name': selectedRecipe.name, 'category': selectedRecipe.category }); } handleGameOver(errors.length === 0, errors); };
            const handleGameOver = (success, errors) => { if (success) { setGameState("RESULT_SUCCESS"); playSound("happy"); confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } }); setResultMessage(SUCCESS_MESSAGES[Math.floor(Math.random() * SUCCESS_MESSAGES.length)]); } else { setErrorDetails(errors); setGameState("RESULT_FAIL"); playSound("sad"); setResultMessage(FAIL_MESSAGES[Math.floor(Math.random() * FAIL_MESSAGES.length)]); } };

            // MODO CUSTOM
            const initCustomGame = () => { const isFemale = Math.random() > 0.5; const nameList = isFemale ? PA_NAMES.FEMALE : PA_NAMES.MALE; const emojiList = isFemale ? PA_EMOJIS.FEMALE : PA_EMOJIS.MALE; setPaPersona({ name: nameList[Math.floor(Math.random() * nameList.length)], emoji: emojiList[Math.floor(Math.random() * emojiList.length)] }); setGameState("CUSTOM_BOWL"); setCustomPhase(1); setAllSelections({}); setCurrentSelections([]); };
            const handleCustomSize = (size) => { setAllSelections(prev => ({...prev, size: size})); setCustomPhase(4); setCurrentSelections([]); };
            const handleCustomNext = () => { if (customPhase === 1) setCustomPhase(2); else if (customPhase === 4) setCustomPhase(5); else if (customPhase === 5) setCustomPhase(6); else if (customPhase === 6) setCustomPhase(7); else if (customPhase === 7) setCustomPhase(8); else if (customPhase === 8) setCustomPhase(9); setCurrentSelections([]); };
            
            const handleCustomBack = () => {
                if (currentSelections.length > 0) { const newSel = [...currentSelections]; newSel.pop(); setCurrentSelections(newSel); return; }
                if (customPhase > 1) { const prevPhase = customPhase === 4 ? 3 : customPhase - 1; setCustomPhase(prevPhase); setCurrentSelections([]); } else { setGameState("HOME"); }
            };

            const handleCustomSelection = (item, type) => {
                const popupTrigger = (msg) => setShowPopup({ msg, callback: () => addCustomItem(item, type) });
                if (type === 'base' && item === "Espinafres") return popupTrigger("Posso colocar um pouco de Azeite, se quiseres?");
                if (type === 'base' && item === "Winter Salad") return popupTrigger("Posso colocar um pouco de Vinagrete, se quiseres?");
                if (type === 'green' && (item === "Abacate" || item === "Manga" || item === "Wakame" || item === "Philadelphia")) { const price = item === "Abacate" ? "50cent" : "30cent"; return popupTrigger(`Este √© um green premium, tem um valor adicional de ${price}.`); }
                if (type === 'protein' && (item === "Salm√£o Braseado" || item === "Fil√© de Salm√£o")) return popupTrigger("Essa prote√≠na tem um adicional de 50cent.");
                if (type === 'sauce' && item === "Creme de Abacate") return popupTrigger("Esse molho tem um adicional de 30cent.");
                addCustomItem(item, type);
            };
            const addCustomItem = (item, type) => {
                setShowPopup(null); let limit = 99; const size = allSelections['size'] || "Regular";
                if (type === 'base') limit = 2; if (type === 'green') limit = size === "Large" ? 5 : 4; if (type === 'protein') limit = size === "Large" ? 3 : 2; if (type === 'sauce') limit = 1; if (type === 'crispy') limit = 2;
                if (currentSelections.length < limit || (type === 'sauce' && currentSelections.length < 1)) { if (type === 'sauce') setCurrentSelections([item]); else setCurrentSelections(prev => [...prev, item]); playSound("happy"); }
            };
            
            const renderCustomBowl = () => {
                const size = allSelections['size'] || "Regular";
                switch(customPhase) {
                    case 1: return ( <div className="flex flex-col items-center justify-center h-full p-6 text-center space-y-8"><div className="text-6xl animate-bounce-subtle">{paPersona.emoji}</div><TypewriterMessage text={`Ol√°, tudo bem? Me chamo ${paPersona.name}, seja bem vind@! J√° conhece a Poke House? Vou ajudar-te a escolher a bowl perfeita para si. Aqui est√° o nosso menu, podes escolher uma de nossas receitas ou criar sua pr√≥pria. Quer criar a sua? √ìtimo!`} /><button onClick={handleCustomNext} className="bg-ph-blue text-slate-800 px-8 py-4 rounded-xl font-bold text-lg shadow-sm hover:shadow-md transition-all active:scale-95 border border-slate-200">Vamos nessa! ü§ô</button></div> );
                    case 2: return ( <div className="flex flex-col items-center justify-center h-full p-6 text-center space-y-8"><TypewriterMessage text="Sua bowl √© para comer aqui ou para levar?" /><div className="flex gap-4"><button onClick={() => setCustomPhase(3)} className="bg-white border border-slate-200 text-slate-700 px-8 py-4 rounded-xl font-bold text-lg shadow-sm hover:bg-slate-50 active:scale-95">COMER AQUI</button><button onClick={() => setShowPopup({ msg: "S√≥ para informar a caixa para levar tem um custo de 20cent, tudo bem?", callback: () => { setShowPopup(null); setCustomPhase(3); } })} className="bg-white border border-slate-200 text-slate-700 px-8 py-4 rounded-xl font-bold text-lg shadow-sm hover:bg-slate-50 active:scale-95">LEVAR</button></div></div> );
                    case 3: return ( <div className="flex flex-col items-center justify-center h-full p-6 text-center space-y-8"><TypewriterMessage text="Preferes o tamanho Large ou Regular?" /><div className="flex gap-4"><button onClick={() => handleCustomSize("Large")} className="bg-ph-blue text-slate-800 px-8 py-6 rounded-xl font-bold text-xl shadow-sm hover:shadow-md active:scale-95 border border-slate-200">LARGE</button><button onClick={() => handleCustomSize("Regular")} className="bg-ph-green text-slate-800 px-8 py-6 rounded-xl font-bold text-xl shadow-sm hover:shadow-md active:scale-95 border border-slate-200">REGULAR</button></div></div> );
                    case 4: return ( <div className="flex flex-col h-full p-4"><div className="mb-4"><TypewriterMessage text="Podes escolher at√© 2 bases. Temos essas dispon√≠veis:" /></div><div className="flex-1 overflow-y-auto grid grid-cols-2 gap-3 pb-20">{INGREDIENTS_DB.bases.map(ing => (<button key={ing} onClick={() => handleCustomSelection(ing, 'base')} className="bg-white border border-slate-200 p-4 rounded-lg shadow-sm hover:bg-slate-50 font-medium text-slate-700 relative text-left">{ing}{currentSelections.filter(i => i === ing).length > 0 && <span className="absolute top-2 right-2 bg-ph-green w-3 h-3 rounded-full"></span>}</button>))}</div></div> );
                    case 5: { const limit = size === "Large" ? 5 : 4; return ( <div className="flex flex-col h-full p-4"><div className="mb-4"><TypewriterMessage text={`Podes escolher agora - ${limit} - greens!`} /></div><div className="flex-1 overflow-y-auto custom-scroll grid grid-cols-2 gap-3 pb-20">{INGREDIENTS_DB.greens.map(ing => (<button key={ing} onClick={() => handleCustomSelection(ing, 'green')} className="bg-white border border-slate-200 p-4 rounded-lg shadow-sm hover:bg-slate-50 font-medium text-slate-700 text-sm relative text-left">{ing}{currentSelections.filter(i => i === ing).length > 0 && <span className="absolute top-2 right-2 bg-ph-green w-3 h-3 rounded-full"></span>}</button>))}</div></div> ); }
                    case 6: { const limit = size === "Large" ? 3 : 2; const proteins = INGREDIENTS_DB.proteins.filter(p => p !== "Wakame"); return ( <div className="flex flex-col h-full p-4"><div className="mb-4"><TypewriterMessage text={`Podes escolher - ${limit} - prote√≠nas!`} /></div><div className="flex-1 overflow-y-auto custom-scroll grid grid-cols-2 gap-3 pb-20">{proteins.map(ing => (<button key={ing} onClick={() => handleCustomSelection(ing, 'protein')} className="bg-white border border-slate-200 p-4 rounded-lg shadow-sm hover:bg-slate-50 font-medium text-slate-700 relative text-left">{ing}{currentSelections.filter(i => i === ing).length > 0 && <span className="absolute top-2 right-2 bg-ph-green text-slate-800 text-xs w-5 h-5 flex items-center justify-center rounded-full font-bold">{currentSelections.filter(i => i === ing).length}</span>}</button>))}</div></div> ); }
                    case 7: return ( <div className="flex flex-col h-full p-4"><div className="mb-4"><TypewriterMessage text="Podes escolher um molho!" /></div><div className="flex-1 overflow-y-auto custom-scroll grid grid-cols-2 gap-3 pb-20">{INGREDIENTS_DB.sauces_final.map(ing => (<button key={ing} onClick={() => handleCustomSelection(ing, 'sauce')} className={`p-4 rounded-lg shadow-sm font-medium text-slate-700 border transition-all text-left ${currentSelections.includes(ing) ? 'bg-ph-blue border-blue-200' : 'bg-white border-slate-200'}`}>{ing}</button>))}</div></div> );
                    case 8: return ( <div className="flex flex-col h-full p-4"><div className="mb-4"><TypewriterMessage text="Podes escolher 2 crispys!" /></div><div className="flex-1 overflow-y-auto custom-scroll grid grid-cols-2 gap-3 pb-20">{INGREDIENTS_DB.crispies.map(ing => (<button key={ing} onClick={() => handleCustomSelection(ing, 'crispy')} className="bg-white border border-slate-200 p-4 rounded-lg shadow-sm hover:bg-slate-50 font-medium text-slate-700 relative text-left">{ing}{currentSelections.filter(i => i === ing).length > 0 && <span className="absolute top-2 right-2 bg-ph-green w-3 h-3 rounded-full"></span>}</button>))}</div></div> );
                    case 9: return ( <div className="flex flex-col items-center justify-center h-full p-6 text-center space-y-8"><MessageBubble text="Aceita s√©samo de oferta?" /><div className="flex gap-4"><button onClick={() => setCustomPhase(10)} className="bg-ph-blue text-slate-800 px-10 py-6 rounded-xl font-bold text-xl shadow-sm hover:shadow-md active:scale-95 border border-slate-200">Sim</button><button onClick={() => setCustomPhase(10)} className="bg-white border border-slate-200 text-slate-600 px-10 py-6 rounded-xl font-bold text-xl shadow-sm hover:bg-slate-50 active:scale-95">N√£o</button></div></div> );
                    case 10: const finalPhrase = FINAL_CUSTOM_PHRASES[Math.floor(Math.random() * FINAL_CUSTOM_PHRASES.length)]; return ( <div className="flex flex-col items-center justify-center h-full p-6 text-center space-y-8 animate-bounce-in"><div className="text-6xl">üéâ</div><h2 className="text-3xl font-extrabold text-slate-800">{finalPhrase}</h2><button onClick={resetToHome} className="bg-ph-green text-slate-800 px-8 py-4 rounded-xl font-bold shadow-sm hover:shadow-md transition-transform active:scale-95 flex items-center justify-center gap-2"><Icon path={Icons.Home} /> Voltar ao In√≠cio</button></div> );
                    default: return null;
                }
            };

            return (
                <div className="fixed inset-0 w-full h-full font-sans text-slate-800 flex flex-col md:flex-row overflow-hidden">
                    <FoodRain active={true} trigger={easterEggTrigger} quantity={rainQuantity} />
                    {showPopup && <PopupModal message={showPopup.msg} onConfirm={showPopup.callback} />}

                    {/* MENU LATERAL */}
                    <div className={`p-6 md:w-1/4 flex flex-col gap-4 transition-all duration-500 z-10 glass-panel shadow-xl ${gameState === "HOME" ? "w-full h-full overflow-y-auto" : (gameState === "CUSTOM_BOWL" ? "hidden" : "hidden md:flex h-full overflow-y-auto")}`}>
                        <div className="mb-4 text-center md:text-left flex justify-center md:justify-start">
                            <img src="https://storage.googleapis.com/ikona-bucket-production/images/5db193be3ea71a0001bb09f7/EXTENDED%20VERSION_original%20colors-617ac363073e550017b9966b.png" alt="Poke House Logo" className="w-4/5 md:w-auto md:h-12 object-contain" />
                        </div>
                        {gameState === "HOME" && menuCategory === null && ( <> <button onClick={initCustomGame} className="mb-4 bg-white border border-ph-pink text-pink-500 p-4 rounded-xl shadow-sm hover:shadow-md transition-all font-bold text-lg animate-bounce-subtle">‚ú® Crie sua pr√≥pria bowl</button> <div onClick={handleEasterEggClick} className="md:hidden text-6xl animate-bounce-subtle text-center mb-6 cursor-pointer select-none" style={{ zIndex: 60 }}>ü•ó</div> </> )}
                        {menuCategory === null && gameState === "HOME" ? ( <div className="flex flex-col gap-4 mt-2 md:mt-0 h-full justify-center md:justify-start"><button onClick={() => setMenuCategory("HOUSE")} className="bg-ph-blue text-slate-800 p-6 rounded-xl shadow-sm hover:shadow-md transition-all transform hover:scale-[1.02] flex flex-col items-center border border-slate-200"><span className="text-4xl mb-2">üêü</span> <span className="text-xl font-bold">House Bowls</span></button><button onClick={() => setMenuCategory("GREEN")} className="bg-ph-green text-slate-800 p-6 rounded-xl shadow-sm hover:shadow-md transition-all transform hover:scale-[1.02] flex flex-col items-center border border-slate-200"><span className="text-4xl mb-2">ü•ó</span> <span className="text-xl font-bold">Green Bowls</span></button><button onClick={() => setMenuCategory("SMOOTHIE")} className="bg-ph-yellow text-slate-800 p-6 rounded-xl shadow-sm hover:shadow-md transition-all transform hover:scale-[1.02] flex flex-col items-center border border-slate-200"><span className="text-4xl mb-2">ü•§</span> <span className="text-xl font-bold">Smoothies</span></button></div> ) : gameState !== "CUSTOM_BOWL" && ( <div className="flex flex-col gap-2 animate-fade-in"><button onClick={() => setMenuCategory(null)} className="mb-2 text-slate-500 font-bold flex items-center gap-2 hover:bg-slate-100 p-2 rounded-lg transition-colors"><Icon path={Icons.ArrowLeft} size={18} /> Voltar</button><h3 className="font-bold text-slate-800 mb-2 uppercase tracking-wide text-sm">{menuCategory} {menuCategory === "SMOOTHIE" ? "" : "BOWLS"}</h3>{RECIPES.filter(r => r.category === menuCategory).map(recipe => ( <button key={recipe.id} onClick={() => startGame(recipe)} disabled={gameState === "PLAYING" && selectedRecipe?.id !== recipe.id} className={`p-3 rounded-lg shadow-sm text-left font-semibold transition-all border ${selectedRecipe?.id === recipe.id ? "bg-slate-800 text-white border-slate-800" : "bg-white text-slate-600 border-slate-200 hover:bg-slate-50"} ${gameState === "PLAYING" && selectedRecipe?.id !== recipe.id ? "opacity-50 hidden md:block" : ""}`}>{recipe.name}</button> ))}</div> )}
                    </div>

                    {/* √ÅREA DO JOGO */}
                    <div className={`flex-1 relative z-10 flex flex-col items-center justify-center p-4 md:p-8 ${gameState === "HOME" ? "hidden md:flex" : "flex h-full"}`}>
                        {gameState === "CUSTOM_BOWL" && ( <div className="w-full h-full glass-panel rounded-2xl flex flex-col overflow-hidden relative shadow-xl"><div className="flex-1 overflow-hidden relative">{renderCustomBowl()}</div>{customPhase >= 4 && customPhase < 9 && ( <div className="h-20 bg-white/80 backdrop-blur-sm border-t border-slate-200 flex items-center justify-between px-6 shrink-0 z-20"><button onClick={handleCustomBack} className="bg-slate-100 p-3 rounded-lg text-slate-600 hover:bg-slate-200 active:scale-95"><Icon path={Icons.ArrowLeft} size={20}/></button><button onClick={resetToHome} className="bg-slate-100 p-3 rounded-lg text-slate-600 hover:bg-slate-200 active:scale-95"><Icon path={Icons.Home} size={20}/></button><button onClick={handleCustomNext} className="bg-slate-800 p-3 rounded-lg text-white shadow-md hover:bg-slate-700 active:scale-95"><Icon path={Icons.ArrowRight} size={20}/></button></div> )}</div> )}
                        
                        {gameState === "PLAYING" && ( <div className="w-full h-full md:h-auto md:max-h-[90vh] max-w-5xl glass-panel rounded-2xl shadow-xl border border-white/50 animate-fade-in flex flex-col overflow-hidden"><div className="p-4 bg-white/40 border-b border-white/50 text-center text-slate-600 font-semibold text-sm md:text-base shrink-0">Receita Atual: <span className="font-bold text-slate-800">{selectedRecipe.name} {selectedSize ? `(${selectedSize})` : ""}</span></div><div className="flex justify-between items-center p-6 border-b border-white/50 shrink-0"><div><h2 className="text-xl md:text-3xl font-bold text-slate-800">{getCurrentPhaseData().title}</h2><p className="text-xs md:text-base text-slate-500 mt-1">{getSelectionLimit() > 1 ? `Escolha ${getSelectionLimit()} op√ß√µes.` : getCurrentPhaseData().hint}</p><div className="text-xs md:text-sm mt-2 font-bold text-slate-400 uppercase tracking-wider">Selecionado: {currentSelections.length} / {getSelectionLimit()}</div></div><div className="flex flex-col items-center min-w-[80px] bg-white/50 rounded-xl p-2"><span className="text-3xl md:text-4xl mb-1">{timerEmoji}</span><span className={`text-xl md:text-2xl font-bold font-mono ${timer <= 6 ? 'text-red-500' : 'text-slate-700'}`}>{timer}s</span></div></div><div className="flex-1 overflow-y-auto p-6 custom-scroll flex items-center justify-center"><div className={`grid gap-3 w-full ${phaseOptions.length > 6 ? 'grid-cols-3' : 'grid-cols-2 md:grid-cols-3'}`}>{phaseOptions.map((ing, idx) => { const count = currentSelections.filter(i => i === ing).length; return (<button key={idx} onClick={() => handleSelection(ing)} className={`relative p-4 rounded-xl font-medium text-sm transition-all active:scale-[0.98] flex items-center justify-center text-center h-24 shadow-sm border hover:shadow-md ${count > 0 ? 'bg-slate-800 text-white border-slate-800 ring-2 ring-slate-300' : 'bg-white text-slate-600 border-slate-200 hover:border-slate-300'}`}>{ing}{count > 0 && <span className="absolute -top-2 -right-2 bg-ph-green text-slate-800 text-xs font-bold w-6 h-6 flex items-center justify-center rounded-full border-2 border-white shadow-sm">{count}</span>}</button>)})}</div></div><div className="p-4 border-t border-white/50 bg-white/30 flex justify-between shrink-0"><button onClick={resetToHome} className="flex items-center gap-2 text-slate-500 font-bold text-sm hover:bg-white/50 px-4 py-2 rounded-lg transition-colors"><Icon path={Icons.Home} size={18}/> IN√çCIO</button><button onClick={handleUndo} disabled={currentSelections.length === 0} className="flex items-center gap-2 px-6 py-2 bg-white border border-slate-200 rounded-lg font-bold text-slate-600 disabled:opacity-50 hover:bg-slate-50 text-sm shadow-sm transition-all"><Icon path={Icons.ArrowLeft} size={18}/> Desfazer</button></div></div> )}

                        {gameState === "RESULT_SUCCESS" && ( <div className="text-center p-12 glass-panel rounded-2xl shadow-2xl animate-bounce-in mx-4 border border-white/60 max-w-md w-full"><h2 className="text-4xl font-extrabold text-green-500 mb-6 drop-shadow-sm flex flex-col items-center justify-center gap-4"><div className="bg-green-100 p-4 rounded-full"><Icon path={Icons.Check} size={48} /></div>PARAB√âNS!</h2><p className="text-slate-600 mb-8 font-medium text-xl">{resultMessage}</p><button onClick={resetToHome} className="mt-4 bg-slate-800 text-white px-8 py-4 rounded-xl font-bold text-lg shadow-lg hover:bg-slate-700 transition-all active:scale-95 flex items-center justify-center gap-2 w-full"><Icon path={Icons.Home} size={20}/> Voltar ao In√≠cio</button></div> )}
                        {gameState === "RESULT_FAIL" && ( <div className="text-center p-8 glass-panel rounded-2xl shadow-2xl animate-shake mx-4 max-h-[80vh] overflow-y-auto custom-scroll border border-white/60 max-w-md w-full"><h2 className="text-3xl font-extrabold text-rose-500 mb-2">EPA! üòü</h2><p className="text-lg text-slate-600 mb-6 font-medium">{resultMessage}</p><div className="bg-rose-50 p-6 rounded-xl text-left text-sm text-rose-600 mb-8 border border-rose-100 shadow-inner font-mono leading-relaxed">{errorDetails.map((e, i) => <div key={i} className="mb-2 flex items-start gap-2"><span>‚Ä¢</span><span>{e}</span></div>)}</div><button onClick={resetToHome} className="bg-slate-800 text-white px-8 py-3 rounded-xl font-bold shadow-lg hover:bg-slate-700 transition-transform active:scale-95 flex items-center justify-center gap-2 mx-auto w-full"><Icon path={Icons.Rotate} size={20}/> Tentar Novamente</button></div> )}
                        {gameState === "HOME" && ( <div className="hidden md:flex flex-col items-center justify-center text-center glass-panel p-12 rounded-3xl shadow-xl max-w-lg"><img src="https://storage.googleapis.com/ikona-bucket-production/images/5db193be3ea71a0001bb09f7/EXTENDED%20VERSION_original%20colors-617ac363073e550017b9966b.png" alt="Poke House Logo" className="h-24 mb-8 object-contain" /><p className="text-slate-800 font-bold text-3xl mb-4">Bem-vindo ao Treino!</p><p className="text-slate-500 mb-8 text-lg">Selecione uma categoria no menu para come√ßar.</p><div className="mt-4 text-7xl animate-bounce-subtle drop-shadow-md">ü•ó</div></div> )}
                    </div>
                    
                    <div className="fixed bottom-2 right-4 z-50"><button onClick={() => setShowChangelog(true)} className="text-xs text-slate-400 font-mono hover:text-slate-600 transition-colors select-none">v5.00</button></div>
                    {showChangelog && <ChangelogModal onClose={() => setShowChangelog(false)} />}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById("root"));
        root.render(<App />);
    </script>
</body>
</html>
