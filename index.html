<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Poke House â€“ Treino v4.05 BETA</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'pastel-pink': { 100: '#FFE6F2', 200: '#FFC8DD', 300: '#FFAFCC', 400: '#FF99C8', 500: '#FF70A6' },
                        'pastel-blue': { 100: '#E0F2FF', 200: '#BDE0FE', 300: '#A0C4FF', 400: '#80A8FF', 500: '#404FC2' },
                        'pastel-green': '#A7F3D0',
                        'pastel-yellow': '#FEF9C3',
                    },
                    animation: {
                        'bounce-in': 'bounceIn 0.8s cubic-bezier(0.215, 0.610, 0.355, 1.000) both',
                        'shake': 'shake 0.8s cubic-bezier(.36,.07,.19,.97) both',
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'pulse-fast': 'pulse 0.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'bounce-slow': 'bounceSlow 2s infinite', // Nova animaÃ§Ã£o lenta
                    },
                    keyframes: {
                        bounceIn: {
                            '0%': { opacity: '0', transform: 'scale3d(0.3, 0.3, 0.3)' },
                            '20%': { transform: 'scale3d(1.1, 1.1, 1.1)' },
                            '40%': { transform: 'scale3d(0.9, 0.9, 0.9)' },
                            '60%': { opacity: '1', transform: 'scale3d(1.03, 1.03, 1.03)' },
                            '80%': { transform: 'scale3d(0.97, 0.97, 0.97)' },
                            '100%': { opacity: '1', transform: 'scale3d(1, 1, 1)' }
                        },
                        shake: {
                            '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' },
                            '20%, 80%': { transform: 'translate3d(2px, 0, 0)' },
                            '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' },
                            '40%, 60%': { transform: 'translate3d(4px, 0, 0)' }
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        bounceSlow: {
                            '0%, 100%': { transform: 'translateY(-5%)', animationTimingFunction: 'cubic-bezier(0.8, 0, 1, 1)' },
                            '50%': { transform: 'translateY(0)', animationTimingFunction: 'cubic-bezier(0, 0, 0.2, 1)' }
                        }
                    }
                }
            }
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        body { margin: 0; overflow: hidden; background-color: #FFE6F2; touch-action: manipulation; }
        .backdrop-blur-md { backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: rgba(0,0,0,0.05); border-radius: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #A0C4FF; border-radius: 4px; }
        .typing-cursor::after { content: '|'; animation: blink 1s step-start infinite; }
        @keyframes blink { 50% { opacity: 0; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- ÃCONES ---
        const IconHome = ({ size = 20, color = "currentColor" }) => (<svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>);
        const IconArrowLeft = ({ size = 20, color = "currentColor" }) => (<svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>);
        const IconArrowRight = ({ size = 20, color = "currentColor" }) => (<svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>);
        const IconRotate = ({ size = 20, color = "currentColor" }) => (<svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>);
        const IconCheck = ({ size = 24, color = "currentColor" }) => (<svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>);
        const IconList = ({ size = 16, color = "currentColor" }) => (<svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>);

        // --- DADOS ---
        const SUCCESS_MESSAGES = ["Ficou perfeita! ðŸ¤©", "Estudou direitinho ein! âœ…", "Ficou igualzinha ao SOP! ðŸ“š", "Que mente de titÃ¢nio! ðŸ§ "];
        const FAIL_MESSAGES = ["Algo nÃ£o tÃ¡ legal. ðŸ¤¨", "O cliente vai reclamar. ðŸ¤¦ðŸ»â€â™‚ï¸", "Precisamos revisar o SOP. ðŸ“š"];
        const PA_NAMES = { MALE: ["Pedro", "Paulo", "Francisco", "Heitor", "Marcelo", "JosÃ©"], FEMALE: ["InÃªs", "Eliz", "Melissa", "Mariana", "Vilma", "Bruna"] };
        const PA_EMOJIS = { MALE: ["ðŸ‘¨", "ðŸ§”ðŸ»", "ðŸ‘¨ðŸ¿", "ðŸ‘¨ðŸ¿â€ðŸ¦°"], FEMALE: ["ðŸ‘©ðŸ»", "ðŸ‘©ðŸ»â€ðŸ¦°", "ðŸ‘©ðŸ¿", "ðŸ‘©"] };
        const FINAL_CUSTOM_PHRASES = ["Uau! Ficou linda sua bowl!", "Bom apetite!", "Prontinho! Experimente um dos nosso sumos naturais.", "Seu rosto Ã© famÃ­liar, jÃ¡ Ã© nosso cliente nÃ©?", "Muito obrigado, volte mais vezes!"];

        const CHANGELOG = [
            { version: "4.05", date: "Atual", changes: ["Ajuste visual: Todos os 4 botÃµes do menu agora tÃªm movimento suave e lento.", "A salada mantÃ©m o movimento rÃ¡pido e frenÃ©tico."] },
            { version: "4.04", date: "Anterior", changes: ["BotÃµes do menu inicial agora pulam e param ao passar o mouse."] },
            { version: "4.03", date: "Anterior", changes: ["CorreÃ§Ã£o: Texto 'comendo letras' removido.", "BotÃ£o Voltar/Desfazer inteligente.", "BotÃµes de tamanho padronizados."] },
            { version: "4.02", date: "Anterior", changes: ["CorreÃ§Ã£o: RestauraÃ§Ã£o da lista completa de receitas."] },
            { version: "4.0", date: "Anterior", changes: ["Novo Modo: 'Crie sua prÃ³pria bowl' (Roleplay de Cliente).", "Sistema de Persona."] }
        ];

        const INGREDIENTS_DB = {
            sizes: ["Regular", "Large"],
            bases: ["Arroz de sushi", "Arroz preto", "Quinoa", "Arroz basmati", "Coconut Basmati", "Espinafres", "Winter Salad"],
            sauces_base: ["Azeite", "Azeite de LimÃ£o", "Vinagrete", "Ponzu", "Sriracha Mayo", "NÃ£o leva"],
            greens: ["Batata Doce com Alecrim", "BrÃ³colis", "Pickle Cebola", "Beterraba", "Cenoura c/ Soja", "Milho", "Abacaxi", "Edamame", "Tomate Cherry", "Couve roxa", "Courgette", "Cenoura", "Grana Padano", "Pepino", "Feta", "JalapeÃ±os", "Azeitonas", "Abacate", "Philadelphia", "Wakame", "Manga", "Hummus", "HortelÃ£ (Fresca)"],
            proteins: ["SalmÃ£o Braseado", "FilÃ© de SalmÃ£o", "Frango Vietnamita", "CamarÃ£o Panado", "Frango", "Frango Teriyaki", "CamarÃ£o", "Juicy Salmon", "Juicy Tuna", "SalmÃ£o", "Atum", "Tofu Grelhado", "Ovo", "NÃ£o leva", "Wakame"],
            sauces_final: ["Creamy Caesar", "Creme de Abacate", "Spicy Peanuts", "Mel", "Chipotle", "SÃ©samo Shoyu", "Sriracha Mayo", "Wasabi Mayo", "Azeite", "Azeite de LimÃ£o", "ManjericÃ£o e HortelÃ£", "Vinagrete", "Soja", "Teriyaki", "Ponzu", "Especial", "Soja e SÃ©samo"],
            crispies: ["Cebola frita", "Ervilhas Wasabi", "Algas Nori", "AmÃªndoa", "Batata Doce", "Lima", "Bacon", "Croutons", "Batata Doce Crocante", "NÃ£o leva", "Cebola Crocante"],
            sesame: ["Sim", "NÃ£o"],
            smoothie_liquid: ["Leite de Coco", "Leite", "Suco de MaÃ§Ã£"],
            smoothie_amount: ["150ml", "250ml", "200ml"],
            smoothie_ingredients: ["Morango", "Banana 90g", "Manga 40g", "AnanÃ¡s 30g", "Pepino 20g", "Abacate 45g", "Espinafre 30g", "Sumo de Lima 25g", "Gengibre 5g"],
            smoothie_ice: ["Gelo 60g", "Gelo 40g", "Gelo 90g"],
            smoothie_mode: ["Modo A", "Modo B", "Modo C", "Modo D", "Modo E", "Modo F"]
        };

        const RECIPES = [
            // HOUSE BOWLS
            { id: 1, category: "HOUSE", name: "Sunny Salmon ðŸŒž", variants: { "Regular": { base: ["Arroz de sushi", "Arroz de sushi"], sauce_base: ["NÃ£o leva"], greens: ["Abacate", "Couve roxa", "Edamame"], protein: ["Juicy Salmon", "Juicy Salmon"], sauce_final: ["Especial", "Creme de Abacate"], crispy: ["NÃ£o leva"], sesame: ["Sim"] }, "Large": { base: ["Arroz de sushi", "Arroz de sushi", "Arroz de sushi"], sauce_base: ["NÃ£o leva"], greens: ["Abacate", "Couve roxa", "Couve roxa", "Edamame", "Edamame"], protein: ["Juicy Salmon", "Juicy Salmon", "Juicy Salmon"], sauce_final: ["Especial", "Creme de Abacate"], crispy: ["NÃ£o leva"], sesame: ["Sim"] } } },
            { id: 2, category: "HOUSE", name: "Spicy Tuna ðŸŸ", variants: { "Regular": { base: ["Arroz de sushi", "Arroz de sushi"], sauce_base: ["NÃ£o leva"], greens: ["Couve roxa", "Pepino", "Cenoura"], protein: ["Atum", "Atum", "Wakame"], sauce_final: ["Ponzu", "Spicy Peanuts"], crispy: ["Cebola frita"], sesame: ["Sim"] }, "Large": { base: ["Arroz de sushi", "Arroz de sushi", "Arroz de sushi"], sauce_base: ["NÃ£o leva"], greens: ["Couve roxa", "Couve roxa", "Pepino", "Pepino", "Cenoura"], protein: ["Atum", "Atum", "Atum", "Wakame"], sauce_final: ["Ponzu", "Spicy Peanuts"], crispy: ["Cebola frita"], sesame: ["Sim"] } } },
            { id: 3, category: "HOUSE", name: "Vegetarian ðŸŒ¿", variants: { "Regular": { base: ["Arroz basmati", "Arroz basmati"], sauce_base: ["NÃ£o leva"], greens: ["Abacate", "Hummus", "Hummus", "Tomate Cherry", "Pepino", "Azeitonas"], protein: ["NÃ£o leva"], sauce_final: ["ManjericÃ£o e HortelÃ£"], crispy: ["AmÃªndoa"], sesame: ["NÃ£o"] }, "Large": { base: ["Arroz basmati", "Arroz basmati", "Arroz basmati"], sauce_base: ["NÃ£o leva"], greens: ["Abacate", "Hummus", "Hummus", "Hummus", "Tomate Cherry", "Pepino", "Azeitonas", "Azeitonas"], protein: ["NÃ£o leva"], sauce_final: ["ManjericÃ£o e HortelÃ£"], crispy: ["AmÃªndoa"], sesame: ["NÃ£o"] } } },
            { id: 4, category: "HOUSE", name: "Chicken ðŸ”", variants: { "Regular": { base: ["Arroz de sushi", "Arroz de sushi"], sauce_base: ["NÃ£o leva"], greens: ["Couve roxa", "Tomate Cherry", "Courgette"], protein: ["Frango Teriyaki", "Frango Teriyaki"], sauce_final: ["Teriyaki", "Sriracha Mayo"], crispy: ["AmÃªndoa"], sesame: ["Sim"] }, "Large": { base: ["Arroz de sushi", "Arroz de sushi", "Arroz de sushi"], sauce_base: ["NÃ£o leva"], greens: ["Couve roxa", "Couve roxa", "Tomate Cherry", "Courgette", "Courgette"], protein: ["Frango Teriyaki", "Frango Teriyaki", "Frango Teriyaki"], sauce_final: ["Teriyaki", "Sriracha Mayo"], crispy: ["AmÃªndoa"], sesame: ["Sim"] } } },
            { id: 5, category: "HOUSE", name: "Fire Salmon ðŸ”¥", variants: { "Regular": { base: ["Arroz de sushi", "Arroz de sushi"], sauce_base: ["Sriracha Mayo"], greens: ["JalapeÃ±os", "Tomate Cherry", "Pepino"], protein: ["SalmÃ£o", "SalmÃ£o"], sauce_final: ["Sriracha Mayo"], crispy: ["Cebola frita"], sesame: ["Sim"] }, "Large": { base: ["Arroz de sushi", "Arroz de sushi", "Arroz de sushi"], sauce_base: ["Sriracha Mayo"], greens: ["JalapeÃ±os", "Tomate Cherry", "Pepino", "Pepino"], protein: ["SalmÃ£o", "SalmÃ£o", "SalmÃ£o"], sauce_final: ["Sriracha Mayo"], crispy: ["Cebola frita"], sesame: ["Sim"] } } },
            { id: 6, category: "HOUSE", name: "Mixed Seas ðŸŒŠ", variants: { "Regular": { base: ["Arroz de sushi", "Arroz de sushi"], sauce_base: ["NÃ£o leva"], greens: ["Manga", "Wakame", "Cenoura", "Pickle Cebola"], protein: ["Atum", "SalmÃ£o"], sauce_final: ["Ponzu"], crispy: ["Ervilhas Wasabi"], sesame: ["Sim"] }, "Large": { base: ["Arroz de sushi", "Arroz de sushi", "Arroz de sushi"], sauce_base: ["NÃ£o leva"], greens: ["Manga", "Wakame", "Cenoura", "Cenoura", "Pickle Cebola"], protein: ["Atum", "SalmÃ£o", "SalmÃ£o"], sauce_final: ["Ponzu"], crispy: ["Ervilhas Wasabi"], sesame: ["Sim"] } } },
            { id: 7, category: "HOUSE", name: "Crispy Shrimp ðŸ¦", variants: { "Regular": { base: ["Arroz de sushi", "Arroz de sushi"], sauce_base: ["NÃ£o leva"], greens: ["Abacate", "Philadelphia", "Manga", "Pepino"], protein: Array(8).fill("CamarÃ£o Panado"), sauce_final: ["Teriyaki", "Sriracha Mayo"], crispy: ["Algas Nori"], sesame: ["Sim"] }, "Large": { base: ["Arroz de sushi", "Arroz de sushi", "Arroz de sushi"], sauce_base: ["NÃ£o leva"], greens: ["Abacate", "Philadelphia", "Manga", "Pepino", "Pepino"], protein: Array(12).fill("CamarÃ£o Panado"), sauce_final: ["Teriyaki", "Sriracha Mayo"], crispy: ["Algas Nori"], sesame: ["Sim"] } } },
            { id: 8, category: "HOUSE", name: "Salmon Sushi ðŸ£", variants: { "Regular": { base: ["Arroz de sushi", "Arroz de sushi"], sauce_base: ["NÃ£o leva"], greens: ["Abacate", "Philadelphia", "Edamame"], protein: ["SalmÃ£o Braseado", "SalmÃ£o Braseado"], sauce_final: ["Teriyaki"], crispy: ["Cebola Crocante"], sesame: ["Sim"] }, "Large": { base: ["Arroz de sushi", "Arroz de sushi", "Arroz de sushi"], sauce_base: ["NÃ£o leva"], greens: ["Abacate", "Philadelphia", "Edamame", "Edamame"], protein: ["SalmÃ£o Braseado", "SalmÃ£o Braseado", "SalmÃ£o Braseado"], sauce_final: ["Teriyaki"], crispy: ["Cebola Crocante"], sesame: ["Sim"] } } },
            { id: 9, category: "GREEN", name: "The Caesar ðŸ¥—", variants: { "Regular": { base: ["Winter Salad", "Winter Salad", "Winter Salad"], sauce_base: ["Vinagrete"], greens: ["Tomate Cherry", "Tomate Cherry", "Grana Padano"], protein: ["Frango", "Frango", "Frango"], sauce_final: ["Creamy Caesar"], crispy: ["Bacon", "Croutons", "Lima"], sesame: ["NÃ£o"] } } },
            { id: 10, category: "GREEN", name: "Exotic Salmon ðŸ¥—", variants: { "Regular": { base: ["Coconut Basmati", "Espinafres", "Espinafres", "Espinafres"], sauce_base: ["Azeite de LimÃ£o"], greens: ["Batata Doce com Alecrim", "Batata Doce com Alecrim", "BrÃ³colis", "Abacate"], protein: ["FilÃ© de SalmÃ£o", "FilÃ© de SalmÃ£o", "FilÃ© de SalmÃ£o"], sauce_final: ["Sriracha Mayo"], crispy: ["NÃ£o leva"], sesame: ["NÃ£o"] } } },
            { id: 11, category: "GREEN", name: "Velvet Garden ðŸ¥—", variants: { "Regular": { base: ["Winter Salad", "Winter Salad", "Winter Salad"], sauce_base: ["Vinagrete"], greens: ["Cenoura c/ Soja", "Beterraba", "Azeitonas", "Pickle Cebola", "Feta", "Feta", "Feta"], protein: ["NÃ£o leva"], sauce_final: ["ManjericÃ£o e HortelÃ£"], crispy: ["NÃ£o leva"], sesame: ["NÃ£o"] } } },
            { id: 12, category: "GREEN", name: "Cozy Chicken ðŸ¥—", variants: { "Regular": { base: ["Coconut Basmati", "Espinafres", "Espinafres"], sauce_base: ["Azeite de LimÃ£o"], greens: ["BrÃ³colis", "Batata Doce com Alecrim", "Couve roxa", "Courgette"], protein: ["Frango Vietnamita", "Frango Vietnamita", "Frango Vietnamita"], sauce_final: ["Soja"], crispy: ["NÃ£o leva"], sesame: ["NÃ£o"] } } },
            { id: 13, category: "SMOOTHIE", name: "Into the Sun ðŸ’›", smoothie_liquid: ["Leite de Coco"], smoothie_amount: ["150ml"], smoothie_ingredients: ["Manga 40g", "Manga 40g", "AnanÃ¡s 30g", "AnanÃ¡s 30g", "Banana 90g"], smoothie_ice: ["Gelo 60g"], smoothie_mode: ["Modo E", "Modo E"] },
            { id: 14, category: "SMOOTHIE", name: "Sweet Pink ðŸ©·", smoothie_liquid: ["Leite"], smoothie_amount: ["150ml"], smoothie_ingredients: ["Morango", "Morango", "Morango", "Morango", "Banana 90g"], smoothie_ice: ["Gelo 60g"], smoothie_mode: ["Modo E", "Modo E"] },
            { id: 15, category: "SMOOTHIE", name: "So Green ðŸ’š", smoothie_liquid: ["Suco de MaÃ§Ã£"], smoothie_amount: ["250ml"], smoothie_ingredients: ["Pepino 20g", "Abacate 45g", "Espinafre 30g", "Sumo de Lima 25g", "Gengibre 5g"], smoothie_ice: ["Gelo 60g"], smoothie_mode: ["Modo E", "Modo E"] }
        ];

        const PHASES_BOWL = [{ key: "size", title: "1ï¸âƒ£ â€“ Tamanho:", hint: "" }, { key: "base", title: "2ï¸âƒ£ â€“ Base:", hint: "" }, { key: "sauce_base", title: "3ï¸âƒ£ â€“ Molho da base:", hint: "" }, { key: "greens", title: "4ï¸âƒ£ â€“ Greens:", hint: "" }, { key: "protein", title: "5ï¸âƒ£ â€“ ProteÃ­na:", hint: "" }, { key: "sauce_final", title: "6ï¸âƒ£ â€“ Molho final:", hint: "" }, { key: "crispy", title: "7ï¸âƒ£ â€“ Crispy:", hint: "" }, { key: "sesame", title: "8ï¸âƒ£ â€“ SÃ©samo:", hint: "" }];
        const PHASES_SMOOTHIE = [{ key: "smoothie_liquid", title: "1ï¸âƒ£ â€“ LÃ­quido:", hint: "" }, { key: "smoothie_amount", title: "2ï¸âƒ£ â€“ Quantidade:", hint: "" }, { key: "smoothie_ingredients", title: "3ï¸âƒ£ â€“ Ingredientes:", hint: "" }, { key: "smoothie_ice", title: "4ï¸âƒ£ â€“ Gelo:", hint: "" }, { key: "smoothie_mode", title: "5ï¸âƒ£ â€“ Blender:", hint: "" }];

        const playSound = (type) => { const AudioContext = window.AudioContext || window.webkitAudioContext; if (!AudioContext) return; const ctx = new AudioContext(); const osc = ctx.createOscillator(); const gain = ctx.createGain(); osc.connect(gain); gain.connect(ctx.destination); const now = ctx.currentTime; if (type === "happy") { osc.type = "sine"; osc.frequency.setValueAtTime(600, now); osc.frequency.exponentialRampToValueAtTime(1200, now + 0.1); gain.gain.setValueAtTime(0.1, now); gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1); osc.start(); osc.stop(now + 0.1); } else { osc.type = "sawtooth"; osc.frequency.setValueAtTime(300, now); osc.frequency.linearRampToValueAtTime(150, now + 0.3); gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0.01, now + 0.3); osc.start(); osc.stop(now + 0.3); } };
        function shuffleArray(array) { let currentIndex = array.length, randomIndex; while (currentIndex != 0) { randomIndex = Math.floor(Math.random() * currentIndex); currentIndex--; [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]]; } return array; }

        // --- VISUAL ---
        const MessageBubble = ({ text }) => (
            <div className="font-mono text-slate-700 text-lg md:text-xl leading-relaxed bg-white/80 p-4 rounded-xl shadow-sm border border-pastel-blue-200 animate-fade-in">
                {text}
            </div>
        );

        const OceanBackground = ({ active, partyMode }) => {
            const canvasRef = React.useRef(null);
            React.useEffect(() => {
                if (!active) return;
                const canvas = canvasRef.current;
                const ctx = canvas.getContext("2d");
                const skyHeightRatio = 0.60; const seaTopHeightRatio = 0.16; 
                const seaLayers = [ { name: "Mar 2", color: "#A0C4FF", startYRatio: skyHeightRatio, endYRatio: 1.0, wave: { amplitude: 5, wavelength: 90, speed: 0.3 } }, { name: "Mar 1", color: "#80A8FF", startYRatio: skyHeightRatio + seaTopHeightRatio, endYRatio: 1.0, wave: { amplitude: 8, wavelength: 120, speed: 0.2 } } ];
                let surfers = []; const SURFER_EMOJIS = ['ðŸ„â€â™‚ï¸', 'ðŸ„â€â™€ï¸']; let fish = []; const FISH_EMOJIS = ['ðŸŸ', 'ðŸ ', 'ðŸ¡'];
                const createSurfer = () => { const startSide = Math.random() > 0.5 ? 'LEFT' : 'RIGHT'; const horizonY = canvas.height * skyHeightRatio; const minY = horizonY + 50; const maxY = canvas.height - 50; const spawnY = minY + Math.random() * (maxY - minY); return { x: startSide === 'LEFT' ? -150 : canvas.width + 150, y: spawnY, speedX: (startSide === 'LEFT' ? 1 : -1) * (0.4 + Math.random() * 0.4), verticalDir: Math.random() > 0.5 ? 1 : -1, verticalSpeedFactor: 0.3 + Math.random() * 0.3, zigzagTimer: 0, zigzagInterval: 150 + Math.floor(Math.random() * 150), sprite: SURFER_EMOJIS[Math.floor(Math.random() * SURFER_EMOJIS.length)], sizeScale: 0.7 + Math.random() * 0.6, active: true, trail: [] }; };
                const createFish = () => { const horizonY = canvas.height * skyHeightRatio; const spawnX = Math.random() * canvas.width; const spawnY = horizonY + 10; return { x: spawnX, y: spawnY, vx: (Math.random() - 0.5) * 2, vy: - (3 + Math.random() * 3), gravity: 0.15, sprite: FISH_EMOJIS[Math.floor(Math.random() * FISH_EMOJIS.length)], sizeScale: 0.5 + Math.random() * 0.3, active: true, life: 1.0, maxLife: 1.0 }; };
                const resize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
                window.addEventListener("resize", resize); resize();
                let animationFrameId; let time = 0;
                const loop = () => {
                    time += 0.01; ctx.clearRect(0, 0, canvas.width, canvas.height); const h = canvas.height; const horizonY = h * skyHeightRatio; 
                    if (partyMode) { const hue = (time * 200) % 360; ctx.fillStyle = `hsl(${hue}, 70%, 85%)`; } else { ctx.fillStyle = "#FFE6F2"; }
                    ctx.fillRect(0, 0, canvas.width, horizonY + 20);
                    seaLayers.forEach(layer => { const startY = h * layer.startYRatio; const endY = h * layer.endYRatio; ctx.fillStyle = layer.color; ctx.beginPath(); ctx.moveTo(0, endY); for (let x = 0; x <= canvas.width; x += 10) { const waveY = startY + Math.sin(x / layer.wave.wavelength + time * layer.wave.speed) * layer.wave.amplitude; ctx.lineTo(x, waveY); } ctx.lineTo(canvas.width, endY); ctx.lineTo(0, endY); ctx.fill(); if(layer.endYRatio === 1.0) ctx.fillRect(0, endY - 1, canvas.width, h - endY + 1); });
                    if (surfers.length < 2 && Math.random() < 0.005) { surfers.push(createSurfer()); }
                    surfers.forEach(f => { f.x += f.speedX; f.zigzagTimer++; let nextY = f.y + (f.speedX * f.verticalDir * f.verticalSpeedFactor); if (f.verticalDir === -1 && nextY < horizonY + 40) { f.verticalDir = 1; f.zigzagTimer = 0; } else if (f.verticalDir === 1 && nextY > h - 40) { f.verticalDir = -1; f.zigzagTimer = 0; } else if (f.zigzagTimer > f.zigzagInterval) { f.verticalDir *= -1; f.zigzagTimer = 0; } f.y += Math.abs(f.speedX) * f.verticalDir * f.verticalSpeedFactor; f.y += Math.sin(time * 2 + f.x * 0.01) * 0.5; if(f.x < -200 || f.x > canvas.width + 200) { f.active = false; } });
                    surfers = surfers.filter(f => f.active);
                    surfers.forEach(f => { ctx.font=`${Math.max(24,f.sizeScale*40)}px sans-serif`; ctx.shadowColor = "rgba(0,80,150,0.2)"; ctx.shadowBlur = 8; ctx.shadowOffsetY = 5; ctx.fillText(f.sprite,f.x,f.y); ctx.shadowBlur = 0; ctx.shadowOffsetY = 0; });
                    if (fish.length < 3 && Math.random() < 0.01) { fish.push(createFish()); }
                    fish.forEach(f => { f.vy += f.gravity; f.x += f.vx; f.y += f.vy; if (f.y > horizonY + 50 && f.vy > 0) { f.active = false; } });
                    fish = fish.filter(f => f.active);
                    fish.forEach(f => { const opacity = Math.max(0, f.life); ctx.globalAlpha = opacity; ctx.font=`${Math.max(16,f.sizeScale*30)}px sans-serif`; ctx.fillText(f.sprite, f.x, f.y); ctx.globalAlpha = 1.0; });
                    animationFrameId = requestAnimationFrame(loop);
                };
                animationFrameId = requestAnimationFrame(loop);
                return () => { window.removeEventListener("resize", resize); cancelAnimationFrame(animationFrameId); };
            }, [active, partyMode]);
            if (!active) return null;
            return <canvas ref={canvasRef} style={{position:'fixed', top:0, left:0, width:'100%', height:'100%', zIndex:-1}} />;
        };

        const EASTER_EGG_EMOJIS = ['ðŸ¥‘','ðŸ…','ðŸ«›','ðŸ¥•','ðŸ«’','ðŸŒ½','ðŸ§…','ðŸ¥¦','ðŸ“','ðŸ¥­','ðŸ','ðŸ£','ðŸ¤','ðŸª','ðŸ¥—','ðŸ§€','ðŸ¥š','ðŸ¥”'];
        const FoodRain = ({ active, trigger, quantity = 1 }) => {
            const canvasRef = React.useRef(null);
            const particlesRef = React.useRef([]);
            React.useEffect(() => {
                if (!trigger || trigger === 0) return;
                const canvas = canvasRef.current;
                if (!canvas) return;
                const newParticles = [];
                for (let i = 0; i < quantity; i++) {
                    const floorY = canvas.height - (Math.random() * (canvas.height * 0.1));
                    newParticles.push({ x: canvas.width / 2, y: canvas.height * 0.4, vx: (Math.random() - 0.5) * 25, vy: (Math.random() - 0.5) * 25, gravity: 0.5, friction: 0.99, elasticity: 0.8, emoji: EASTER_EGG_EMOJIS[Math.floor(Math.random() * EASTER_EGG_EMOJIS.length)], size: 30 + Math.random() * 20, floorY: floorY, life: 1.0, settled: false });
                }
                particlesRef.current = [...particlesRef.current, ...newParticles];
            }, [trigger, quantity]);
            React.useEffect(() => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext("2d");
                const resize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
                window.addEventListener("resize", resize); resize();
                let animId;
                const render = () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    particlesRef.current = particlesRef.current.filter(p => p.life > 0);
                    particlesRef.current.forEach(p => {
                        if (!p.settled) { p.vy += p.gravity; p.x += p.vx; p.y += p.vy; if (p.x < 0 || p.x > canvas.width) { p.vx *= -1; p.x = p.x < 0 ? 0 : canvas.width; } if (p.y > p.floorY) { p.y = p.floorY; p.vy *= -p.elasticity; p.vx *= 0.9; if (Math.abs(p.vy) < 1 && Math.abs(p.vx) < 1) p.settled = true; } } else { p.life -= 0.01; }
                        ctx.globalAlpha = Math.max(0, p.life); ctx.font = `${p.size}px sans-serif`; ctx.fillText(p.emoji, p.x, p.y); ctx.globalAlpha = 1.0;
                    });
                    animId = requestAnimationFrame(render);
                };
                render();
                return () => { window.removeEventListener("resize", resize); cancelAnimationFrame(animId); };
            }, []);
            return <canvas ref={canvasRef} className="fixed inset-0 w-full h-full pointer-events-none z-50" />;
        };

        const PopupModal = ({ message, onConfirm }) => (
            <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/20 backdrop-blur-sm animate-fade-in">
                <div className="bg-white p-6 rounded-2xl shadow-2xl border-2 border-pastel-blue-300 max-w-sm w-full mx-4 text-center transform scale-100 animate-bounce-in">
                    <p className="text-lg font-bold text-slate-700 mb-6">{message}</p>
                    <button onClick={onConfirm} className="text-4xl hover:scale-110 transition-transform bg-pastel-green/20 p-3 rounded-full border-2 border-pastel-green">ðŸ†—</button>
                </div>
            </div>
        );

        const ChangelogModal = ({ onClose }) => (
            <div className="fixed inset-0 z-[60] bg-black/40 flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in">
                <div className="bg-white rounded-2xl p-6 max-w-md w-full max-h-[80vh] overflow-y-auto shadow-2xl relative">
                    <button onClick={onClose} className="absolute top-4 right-4 text-slate-400 hover:text-slate-600"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
                    <h3 className="font-bold text-2xl mb-6 text-pastel-blue-500 flex items-center gap-2"><IconList /> HistÃ³rico de VersÃµes</h3>
                    <div className="space-y-6">{CHANGELOG.map((item, index) => (<div key={index} className="border-l-4 border-pastel-blue-200 pl-4"><div className="flex justify-between items-baseline mb-1"><span className="font-bold text-lg text-slate-700">v{item.version}</span><span className="text-xs font-semibold text-slate-400 uppercase tracking-wide">{item.date}</span></div><ul className="list-disc list-inside text-sm text-slate-600 space-y-1">{item.changes.map((change, i) => (<li key={i}>{change}</li>))}</ul></div>))}</div>
                    <div className="mt-8 pt-4 border-t border-slate-100 text-center"><button onClick={onClose} className="bg-slate-100 text-slate-600 px-6 py-2 rounded-full font-bold text-sm hover:bg-slate-200 transition-colors">Fechar</button></div>
                </div>
            </div>
        );

        // --- APP PRINCIPAL ---
        function App() {
            const [gameState, setGameState] = React.useState("HOME");
            const [menuCategory, setMenuCategory] = React.useState(null); 
            const [selectedRecipe, setSelectedRecipe] = React.useState(null);
            const [selectedSize, setSelectedSize] = React.useState(null); 
            const [currentPhaseIndex, setCurrentPhaseIndex] = React.useState(0);
            const [currentSelections, setCurrentSelections] = React.useState([]);
            const [allSelections, setAllSelections] = React.useState({});
            const [phaseOptions, setPhaseOptions] = React.useState([]);
            const [timer, setTimer] = React.useState(20);
            const [timerEmoji, setTimerEmoji] = React.useState("ðŸ˜ƒ");
            const [errorDetails, setErrorDetails] = React.useState([]);
            const [showChangelog, setShowChangelog] = React.useState(false);
            const [resultMessage, setResultMessage] = React.useState("");
            
            const [customPhase, setCustomPhase] = React.useState(0);
            const [paPersona, setPaPersona] = React.useState({ name: "", emoji: "" });
            const [showPopup, setShowPopup] = React.useState(null);

            const [easterEggTrigger, setEasterEggTrigger] = React.useState(0);
            const [rainQuantity, setRainQuantity] = React.useState(1);
            const [partyMode, setPartyMode] = React.useState(false);
            const [keys, setKeys] = React.useState([]);

            const handleEasterEggClick = () => { if (window.innerWidth < 768 && window.innerHeight > window.innerWidth) { setRainQuantity(1); setEasterEggTrigger(prev => prev + 1); } };
            React.useEffect(() => { const handleKeyDown = (event) => { setKeys(prev => { const newKeys = [...prev, event.key].slice(-8); if (newKeys.join('') === 'ArrowUpArrowUppokeArrowUpArrowUp') { activatePartyMode(); } return newKeys; }); }; window.addEventListener('keydown', handleKeyDown); return () => window.removeEventListener('keydown', handleKeyDown); }, []);
            const activatePartyMode = () => { setPartyMode(true); setRainQuantity(50); setEasterEggTrigger(prev => prev + 1); confetti({ particleCount: 200, spread: 150, origin: { y: 0.6 }, colors: ['#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#FF00FF'] }); setTimeout(() => { setPartyMode(false); }, 3000); };

            const getCurrentPhases = () => { if (selectedRecipe?.category === "SMOOTHIE") return PHASES_SMOOTHIE; return PHASES_BOWL; };
            const getFullIngredientList = (key) => { if(key === 'base') return INGREDIENTS_DB.bases; if(key === 'sauce_base') return INGREDIENTS_DB.sauces_base; if(key === 'greens') return INGREDIENTS_DB.greens; if(key === 'protein') return INGREDIENTS_DB.proteins; if(key === 'sauce_final') return INGREDIENTS_DB.sauces_final; if(key === 'crispy') return INGREDIENTS_DB.crispies; if(key === 'sesame') return INGREDIENTS_DB.sesame; if(key === 'smoothie_liquid') return INGREDIENTS_DB.smoothie_liquid; if(key === 'smoothie_amount') return INGREDIENTS_DB.smoothie_amount; if(key === 'smoothie_ingredients') return INGREDIENTS_DB.smoothie_ingredients; if(key === 'smoothie_ice') return INGREDIENTS_DB.smoothie_ice; if(key === 'smoothie_mode') return INGREDIENTS_DB.smoothie_mode; return []; };
            const getCurrentPhaseData = () => { if(!selectedRecipe) return {}; const phases = getCurrentPhases(); return phases[currentPhaseIndex]; };
            const getSelectionLimit = () => { if (!selectedRecipe) return 0; const phaseKey = getCurrentPhases()[currentPhaseIndex].key; if (phaseKey === "size") return 1; if (selectedRecipe.category === "SMOOTHIE") { return selectedRecipe[phaseKey].length; } else { const sizeToUse = selectedSize || "Regular"; return selectedRecipe.variants[sizeToUse] ? selectedRecipe.variants[sizeToUse][phaseKey].length : 0; } };

            React.useEffect(() => { if (gameState === "PLAYING") { if (timer > 16) setTimerEmoji("ðŸ˜ƒ"); else if (timer > 12) setTimerEmoji("ðŸ™‚"); else if (timer > 8) setTimerEmoji("ðŸ˜"); else if (timer > 4) setTimerEmoji("ðŸ˜¦"); else setTimerEmoji("ðŸ˜±"); if (timer === 0) { handleGameOver(false, ["Tempo esgotado!"]); return; } const interval = setInterval(() => setTimer(t => t - 1), 1000); return () => clearInterval(interval); } }, [timer, gameState]);
            
            React.useEffect(() => {
                if (gameState === "PLAYING" && selectedRecipe) {
                    const activePhases = getCurrentPhases();
                    const phaseKey = activePhases[currentPhaseIndex].key;
                    if (phaseKey === "size") { setPhaseOptions(INGREDIENTS_DB.sizes); return; }
                    let fullList = getFullIngredientList(phaseKey);
                    let requiredIngs = [];
                    if (selectedRecipe.category === "SMOOTHIE") { requiredIngs = selectedRecipe[phaseKey]; } else { const sizeToUse = selectedSize || "Regular"; if (selectedRecipe.variants && selectedRecipe.variants[sizeToUse]) { requiredIngs = selectedRecipe.variants[sizeToUse][phaseKey]; } else { requiredIngs = []; } }
                    const requiredSet = new Set(requiredIngs); const requiredUnique = [...requiredSet]; const distractors = fullList.filter(ing => !requiredSet.has(ing)); const shuffledDistractors = shuffleArray([...distractors]); const slotsNeeded = Math.max(0, 9 - requiredUnique.length); const selectedDistractors = shuffledDistractors.slice(0, slotsNeeded); const finalOptions = shuffleArray([...requiredUnique, ...selectedDistractors]);
                    setPhaseOptions(finalOptions);
                }
            }, [currentPhaseIndex, gameState, selectedRecipe, selectedSize]);

            const startGame = (recipe) => { setSelectedRecipe(recipe); setGameState("PLAYING"); if (recipe.category === "GREEN") { setSelectedSize("Regular"); setCurrentPhaseIndex(1); } else if (recipe.category === "SMOOTHIE") { setSelectedSize(null); setCurrentPhaseIndex(0); } else { setSelectedSize(null); setCurrentPhaseIndex(0); } setCurrentSelections([]); setAllSelections({}); setTimer(20); };
            const resetToHome = () => { setGameState("HOME"); setMenuCategory(null); setSelectedRecipe(null); setSelectedSize(null); };
            const handleSelection = (ingredient) => {
                const activePhases = getCurrentPhases(); const phaseKey = activePhases[currentPhaseIndex].key;
                if (phaseKey === "size") { setSelectedSize(ingredient); setCurrentPhaseIndex(prev => prev + 1); setTimer(20); return; }
                setTimer(20);
                let requiredList = []; if (selectedRecipe.category === "SMOOTHIE") { requiredList = selectedRecipe[phaseKey]; } else { const sizeToUse = selectedSize || "Regular"; requiredList = selectedRecipe.variants[sizeToUse][phaseKey]; }
                const isCorrect = requiredList.includes(ingredient); playSound(isCorrect ? "happy" : "sad");
                const newSelections = [...currentSelections, ingredient]; setCurrentSelections(newSelections);
                if (newSelections.length === requiredList.length) {
                    const updatedAll = { ...allSelections, [phaseKey]: newSelections }; setAllSelections(updatedAll);
                    if (currentPhaseIndex < activePhases.length - 1) { setTimeout(() => { setCurrentPhaseIndex(prev => prev + 1); setCurrentSelections([]); setTimer(20); }, 300); } else { validateGame(updatedAll); }
                }
            };
            const handleUndo = () => { if (currentSelections.length > 0) { const newSel = [...currentSelections]; newSel.pop(); setCurrentSelections(newSel); } };
            const validateGame = (finalSelections) => { let errors = []; const activePhases = getCurrentPhases(); const phasesToValidate = activePhases.filter(p => p.key !== "size"); phasesToValidate.forEach(phase => { let required = []; if (selectedRecipe.category === "SMOOTHIE") { required = selectedRecipe[phase.key]; } else { const sizeToUse = selectedSize || "Regular"; required = selectedRecipe.variants[sizeToUse][phase.key]; } const requiredSorted = [...required].sort(); const selectedSorted = [...finalSelections[phase.key]].sort(); if (JSON.stringify(requiredSorted) !== JSON.stringify(selectedSorted)) { errors.push(`Erro em ${phase.title.replace(":", "")}. Era: ${requiredSorted.join(", ")}`); } }); if (errors.length === 0 && window.gtag) { window.gtag('event', 'bowl_concluida', { 'recipe_name': selectedRecipe.name, 'category': selectedRecipe.category }); } handleGameOver(errors.length === 0, errors); };
            const handleGameOver = (success, errors) => { if (success) { setGameState("RESULT_SUCCESS"); playSound("happy"); confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } }); setResultMessage(SUCCESS_MESSAGES[Math.floor(Math.random() * SUCCESS_MESSAGES.length)]); } else { setErrorDetails(errors); setGameState("RESULT_FAIL"); playSound("sad"); setResultMessage(FAIL_MESSAGES[Math.floor(Math.random() * FAIL_MESSAGES.length)]); } };

            // MODO CUSTOM
            const initCustomGame = () => { const isFemale = Math.random() > 0.5; const nameList = isFemale ? PA_NAMES.FEMALE : PA_NAMES.MALE; const emojiList = isFemale ? PA_EMOJIS.FEMALE : PA_EMOJIS.MALE; setPaPersona({ name: nameList[Math.floor(Math.random() * nameList.length)], emoji: emojiList[Math.floor(Math.random() * emojiList.length)] }); setGameState("CUSTOM_BOWL"); setCustomPhase(1); setAllSelections({}); setCurrentSelections([]); };
            const handleCustomSize = (size) => { setAllSelections(prev => ({...prev, size: size})); setCustomPhase(4); setCurrentSelections([]); };
            const handleCustomNext = () => { if (customPhase === 1) setCustomPhase(2); else if (customPhase === 4) setCustomPhase(5); else if (customPhase === 5) setCustomPhase(6); else if (customPhase === 6) setCustomPhase(7); else if (customPhase === 7) setCustomPhase(8); else if (customPhase === 8) setCustomPhase(9); setCurrentSelections([]); };
            
            // CORREÃ‡ÃƒO: BOTÃƒO VOLTAR/DESFAZER
            const handleCustomBack = () => {
                // Se houver itens selecionados na etapa atual, remove o Ãºltimo
                if (currentSelections.length > 0) {
                    const newSel = [...currentSelections];
                    newSel.pop();
                    setCurrentSelections(newSel);
                    return;
                }
                
                // Se nÃ£o houver, volta a fase
                if (customPhase > 1) { 
                    // Pula a fase 3 se voltar da 4 (porque a 3 Ã© a escolha de tamanho que jÃ¡ foi feita)
                    const prevPhase = customPhase === 4 ? 3 : customPhase - 1;
                    setCustomPhase(prevPhase); 
                    setCurrentSelections([]); 
                } else { 
                    setGameState("HOME"); 
                }
            };

            const handleCustomSelection = (item, type) => {
                const popupTrigger = (msg) => setShowPopup({ msg, callback: () => addCustomItem(item, type) });
                if (type === 'base' && item === "Espinafres") return popupTrigger("Posso colocar um pouco de Azeite, se quiseres?");
                if (type === 'base' && item === "Winter Salad") return popupTrigger("Posso colocar um pouco de Vinagrete, se quiseres?");
                if (type === 'green' && (item === "Abacate" || item === "Manga" || item === "Wakame" || item === "Philadelphia")) { const price = item === "Abacate" ? "50cent" : "30cent"; return popupTrigger(`Este Ã© um green premium, tem um valor adicional de ${price}.`); }
                if (type === 'protein' && (item === "SalmÃ£o Braseado" || item === "FilÃ© de SalmÃ£o")) return popupTrigger("Essa proteÃ­na tem um adicional de 50cent.");
                if (type === 'sauce' && item === "Creme de Abacate") return popupTrigger("Esse molho tem um adicional de 30cent.");
                addCustomItem(item, type);
            };
            const addCustomItem = (item, type) => {
                setShowPopup(null); let limit = 99; const size = allSelections['size'] || "Regular";
                if (type === 'base') limit = 2; if (type === 'green') limit = size === "Large" ? 5 : 4; if (type === 'protein') limit = size === "Large" ? 3 : 2; if (type === 'sauce') limit = 1; if (type === 'crispy') limit = 2;
                if (currentSelections.length < limit || (type === 'sauce' && currentSelections.length < 1)) { if (type === 'sauce') setCurrentSelections([item]); else setCurrentSelections(prev => [...prev, item]); playSound("happy"); }
            };
            
            const renderCustomBowl = () => {
                const size = allSelections['size'] || "Regular";
                switch(customPhase) {
                    case 1: return ( <div className="flex flex-col items-center justify-center h-full p-6 text-center space-y-8"><div className="text-6xl animate-bounce">{paPersona.emoji}</div><MessageBubble text={`OlÃ¡, tudo bem? Me chamo ${paPersona.name}, seja bem vind@! JÃ¡ conhece a Poke House? Vou ajudar-te a escolher a bowl perfeita para si. Aqui estÃ¡ o nosso menu, podes escolher uma de nossas receitas ou criar sua prÃ³pria. Quer criar a sua? Ã“timo!`} /><button onClick={handleCustomNext} className="bg-pastel-blue-500 text-white px-8 py-4 rounded-full font-bold text-xl shadow-lg hover:bg-pastel-blue-400 transition-all active:scale-95 animate-wiggle">Vamos nessa! ðŸ¤™</button></div> );
                    case 2: return ( <div className="flex flex-col items-center justify-center h-full p-6 text-center space-y-8"><MessageBubble text="Sua bowl Ã© para comer aqui ou para levar?" /><div className="flex gap-4"><button onClick={() => setCustomPhase(3)} className="bg-white border-2 border-pastel-blue-300 text-pastel-blue-500 px-8 py-4 rounded-2xl font-bold text-xl shadow-md hover:bg-pastel-blue-50 active:scale-95">COMER AQUI</button><button onClick={() => setShowPopup({ msg: "SÃ³ para informar a caixa para levar tem um custo de 20cent, tudo bem?", callback: () => { setShowPopup(null); setCustomPhase(3); } })} className="bg-white border-2 border-pastel-pink-300 text-pastel-pink-500 px-8 py-4 rounded-2xl font-bold text-xl shadow-md hover:bg-pastel-pink-50 active:scale-95">LEVAR</button></div></div> );
                    case 3: return ( <div className="flex flex-col items-center justify-center h-full p-6 text-center space-y-8"><MessageBubble text="Preferes o tamanho Large ou Regular?" /><div className="flex gap-4"><button onClick={() => handleCustomSize("Large")} className="bg-pastel-blue-500 text-white px-8 py-6 rounded-2xl font-bold text-2xl shadow-lg active:scale-95 animate-bounce-slow hover:animate-none hover:scale-105 transition-transform">LARGE</button><button onClick={() => handleCustomSize("Regular")} className="bg-pastel-green text-slate-700 px-8 py-6 rounded-2xl font-bold text-2xl shadow-lg active:scale-95 animate-bounce-slow hover:animate-none hover:scale-105 transition-transform">REGULAR</button></div></div> );
                    case 4: return ( <div className="flex flex-col h-full p-4"><div className="mb-4"><MessageBubble text="Podes escolher atÃ© 2 bases. Temos essas disponÃ­veis:" /></div><div className="flex-1 overflow-y-auto grid grid-cols-2 gap-3 pb-20">{INGREDIENTS_DB.bases.map(ing => (<button key={ing} onClick={() => handleCustomSelection(ing, 'base')} className="bg-white border border-pastel-blue-200 p-4 rounded-xl shadow-sm hover:border-pastel-blue-400 font-bold text-slate-700 relative">{ing}{currentSelections.filter(i => i === ing).length > 0 && <span className="absolute top-1 right-1 bg-green-500 w-3 h-3 rounded-full"></span>}</button>))}</div></div> );
                    case 5: { const limit = size === "Large" ? 5 : 4; return ( <div className="flex flex-col h-full p-4"><div className="mb-4"><MessageBubble text={`Podes escolher agora - ${limit} - greens!`} /></div><div className="flex-1 overflow-y-auto custom-scroll grid grid-cols-2 gap-3 pb-20">{INGREDIENTS_DB.greens.map(ing => (<button key={ing} onClick={() => handleCustomSelection(ing, 'green')} className="bg-white border border-pastel-blue-200 p-4 rounded-xl shadow-sm hover:border-pastel-blue-400 font-bold text-slate-700 text-sm relative">{ing}{currentSelections.filter(i => i === ing).length > 0 && <span className="absolute top-1 right-1 bg-green-500 w-3 h-3 rounded-full"></span>}</button>))}</div></div> ); }
                    case 6: { const limit = size === "Large" ? 3 : 2; const proteins = INGREDIENTS_DB.proteins.filter(p => p !== "Wakame"); return ( <div className="flex flex-col h-full p-4"><div className="mb-4"><MessageBubble text={`Podes escolher - ${limit} - proteÃ­nas!`} /></div><div className="flex-1 overflow-y-auto custom-scroll grid grid-cols-2 gap-3 pb-20">{proteins.map(ing => (<button key={ing} onClick={() => handleCustomSelection(ing, 'protein')} className="bg-white border border-pastel-blue-200 p-4 rounded-xl shadow-sm hover:border-pastel-blue-400 font-bold text-slate-700 relative">{ing}{currentSelections.filter(i => i === ing).length > 0 && <span className="absolute top-1 right-1 bg-green-500 text-white text-xs w-5 h-5 flex items-center justify-center rounded-full">{currentSelections.filter(i => i === ing).length}</span>}</button>))}</div></div> ); }
                    case 7: return ( <div className="flex flex-col h-full p-4"><div className="mb-4"><MessageBubble text="Podes escolher um molho!" /></div><div className="flex-1 overflow-y-auto custom-scroll grid grid-cols-2 gap-3 pb-20">{INGREDIENTS_DB.sauces_final.map(ing => (<button key={ing} onClick={() => handleCustomSelection(ing, 'sauce')} className={`p-4 rounded-xl shadow-sm font-bold text-slate-700 border transition-all ${currentSelections.includes(ing) ? 'bg-pastel-blue-100 border-pastel-blue-500' : 'bg-white border-pastel-blue-200'}`}>{ing}</button>))}</div></div> );
                    case 8: return ( <div className="flex flex-col h-full p-4"><div className="mb-4"><MessageBubble text="Podes escolher 2 crispys!" /></div><div className="flex-1 overflow-y-auto custom-scroll grid grid-cols-2 gap-3 pb-20">{INGREDIENTS_DB.crispies.map(ing => (<button key={ing} onClick={() => handleCustomSelection(ing, 'crispy')} className="bg-white border border-pastel-blue-200 p-4 rounded-xl shadow-sm hover:border-pastel-blue-400 font-bold text-slate-700 relative">{ing}{currentSelections.filter(i => i === ing).length > 0 && <span className="absolute top-1 right-1 bg-green-500 w-3 h-3 rounded-full"></span>}</button>))}</div></div> );
                    case 9: return ( <div className="flex flex-col items-center justify-center h-full p-6 text-center space-y-8"><MessageBubble text="Aceita sÃ©samo de oferta?" /><div className="flex gap-4"><button onClick={() => setCustomPhase(10)} className="bg-pastel-blue-500 text-white px-10 py-6 rounded-2xl font-bold text-2xl shadow-lg active:scale-95">Sim</button><button onClick={() => setCustomPhase(10)} className="bg-white border-2 border-slate-200 text-slate-500 px-10 py-6 rounded-2xl font-bold text-2xl shadow-md active:scale-95">NÃ£o</button></div></div> );
                    case 10: const finalPhrase = FINAL_CUSTOM_PHRASES[Math.floor(Math.random() * FINAL_CUSTOM_PHRASES.length)]; return ( <div className="flex flex-col items-center justify-center h-full p-6 text-center space-y-8 animate-bounce-in"><div className="text-6xl">ðŸŽ‰</div><h2 className="text-3xl font-extrabold text-pastel-blue-500">{finalPhrase}</h2><button onClick={resetToHome} className="bg-pastel-green text-slate-800 px-8 py-4 rounded-full font-bold shadow-lg hover:bg-green-300 transition-transform active:scale-95 flex items-center justify-center gap-2"><IconHome /> Voltar ao InÃ­cio</button></div> );
                    default: return null;
                }
            };

            return (
                <div className="fixed inset-0 w-full h-full font-sans text-slate-800 flex flex-col md:flex-row overflow-hidden">
                    <OceanBackground active={gameState !== "PLAYING" && gameState !== "CUSTOM_BOWL"} partyMode={partyMode} />
                    <FoodRain active={true} trigger={easterEggTrigger} quantity={rainQuantity} />
                    {partyMode && <div className="fixed inset-0 z-[70] flex items-center justify-center pointer-events-none"><h1 className="text-6xl md:text-8xl font-black text-white drop-shadow-[0_5px_5px_rgba(0,0,0,0.5)] animate-pulse-fast text-center">LIVE PINK! ðŸ¤™</h1></div>}
                    {showPopup && <PopupModal message={showPopup.msg} onConfirm={showPopup.callback} />}

                    {/* MENU LATERAL */}
                    <div className={`p-4 md:w-1/4 flex flex-col gap-2 transition-all duration-500 z-10 bg-pastel-blue-100/80 backdrop-blur-md border-r border-pastel-blue-200/40 shadow-lg ${gameState === "HOME" ? "w-full h-full overflow-y-auto" : (gameState === "CUSTOM_BOWL" ? "hidden" : "hidden md:flex h-full overflow-y-auto")}`}>
                        <div className="mb-6 text-center md:text-left flex justify-center md:justify-start">
                            <img src="https://storage.googleapis.com/ikona-bucket-production/images/5db193be3ea71a0001bb09f7/EXTENDED%20VERSION_original%20colors-617ac363073e550017b9966b.png" alt="Poke House Logo" className="w-4/5 md:w-auto md:h-16 object-contain" />
                        </div>
                        {gameState === "HOME" && menuCategory === null && ( <> <button onClick={initCustomGame} className="mb-4 bg-white border-2 border-pastel-pink-400 text-pastel-pink-500 p-4 rounded-2xl shadow-lg hover:bg-pastel-pink-50 transition-all font-bold text-lg animate-bounce-slow hover:animate-none hover:scale-105 transform">âœ¨ Crie sua prÃ³pria bowl</button> <div onClick={handleEasterEggClick} className="md:hidden text-6xl animate-bounce text-center mb-6 cursor-pointer select-none active:scale-95 transition-transform" style={{ zIndex: 60 }}>ðŸ¥—</div> </> )}
                        {menuCategory === null && gameState === "HOME" ? ( <div className="flex flex-col gap-4 mt-4 md:mt-0 h-full justify-center md:justify-start"><button onClick={() => setMenuCategory("HOUSE")} className="bg-pastel-blue-400 text-white p-6 rounded-2xl shadow-lg hover:bg-pastel-blue-500 transition-all transform hover:scale-105 flex flex-col items-center animate-bounce-slow hover:animate-none"><span className="text-4xl mb-2">ðŸŸ</span> <span className="text-xl font-bold">House Bowls</span></button><button onClick={() => setMenuCategory("GREEN")} className="bg-pastel-green text-slate-800 p-6 rounded-2xl shadow-lg hover:bg-green-300 transition-all transform hover:scale-105 flex flex-col items-center animate-bounce-slow hover:animate-none"><span className="text-4xl mb-2">ðŸ¥—</span> <span className="text-xl font-bold">Green Bowls</span></button><button onClick={() => setMenuCategory("SMOOTHIE")} className="bg-pastel-yellow text-slate-800 p-6 rounded-2xl shadow-lg hover:bg-yellow-200 transition-all transform hover:scale-105 flex flex-col items-center animate-bounce-slow hover:animate-none"><span className="text-4xl mb-2">ðŸ¥¤</span> <span className="text-xl font-bold">Smoothies</span></button></div> ) : gameState !== "CUSTOM_BOWL" && ( <div className="flex flex-col gap-2 animate-fade-in"><button onClick={() => setMenuCategory(null)} className="mb-2 text-pastel-blue-500 font-bold flex items-center gap-2 hover:bg-pastel-blue-100/50 p-2 rounded-lg"><IconArrowLeft size={16} color="#404FC2"/> Voltar</button><h3 className="font-bold text-pastel-blue-500 mb-2 uppercase tracking-wide">{menuCategory} {menuCategory === "SMOOTHIE" ? "" : "BOWLS"}</h3>{RECIPES.filter(r => r.category === menuCategory).map(recipe => ( <button key={recipe.id} onClick={() => startGame(recipe)} disabled={gameState === "PLAYING" && selectedRecipe?.id !== recipe.id} className={`p-3 rounded-xl shadow-sm text-left font-semibold transition-all ${selectedRecipe?.id === recipe.id ? "bg-pastel-blue-300 text-white scale-105" : "bg-pastel-blue-100/80 hover:bg-pastel-blue-200/80 text-slate-700"} ${gameState === "PLAYING" && selectedRecipe?.id !== recipe.id ? "opacity-50 hidden md:block" : ""}`}>{recipe.name}</button> ))}</div> )}
                    </div>

                    {/* ÃREA DO JOGO */}
                    <div className={`flex-1 relative z-10 flex flex-col items-center justify-center p-2 md:p-6 ${gameState === "HOME" ? "hidden md:flex" : "flex h-full"}`}>
                        {gameState === "CUSTOM_BOWL" && ( <div className="w-full h-full bg-pastel-blue-100/95 backdrop-blur-md flex flex-col overflow-hidden relative"><div className="flex-1 overflow-hidden relative">{renderCustomBowl()}</div>{customPhase >= 4 && customPhase < 9 && ( <div className="h-20 bg-white border-t border-slate-200 flex items-center justify-between px-6 shrink-0 z-20"><button onClick={handleCustomBack} className="bg-slate-100 p-3 rounded-full text-slate-600 hover:bg-slate-200 active:scale-95"><IconArrowLeft size={24}/></button><button onClick={resetToHome} className="bg-pastel-blue-100 p-3 rounded-full text-pastel-blue-600 hover:bg-pastel-blue-200 active:scale-95"><IconHome size={24}/></button><button onClick={handleCustomNext} className="bg-pastel-blue-500 p-3 rounded-full text-white shadow-lg hover:bg-pastel-blue-600 active:scale-95 animate-pulse-fast"><IconArrowRight size={24}/></button></div> )}</div> )}
                        
                        {gameState === "PLAYING" && ( <div className="w-full h-full md:h-auto md:max-h-[90vh] max-w-5xl bg-pastel-blue-100/85 backdrop-blur-md rounded-xl md:rounded-3xl shadow-xl border border-pastel-blue-200/50 animate-fade-in flex flex-col overflow-hidden"><div className="p-2 bg-pastel-blue-200/50 text-center text-pastel-blue-500 font-semibold text-sm md:text-base border-b border-pastel-blue-200/50 shrink-0">Receita Atual: <span className="font-bold">{selectedRecipe.name} {selectedSize ? `(${selectedSize})` : ""}</span></div><div className="flex justify-between items-center p-4 border-b border-pastel-blue-200/50 bg-pastel-blue-100/40 shrink-0"><div><h2 className="text-xl md:text-3xl font-bold text-pastel-blue-500">{getCurrentPhaseData().title}</h2><p className="text-xs md:text-base text-slate-600">{getSelectionLimit() > 1 ? `Escolha ${getSelectionLimit()} opÃ§Ãµes.` : getCurrentPhaseData().hint}</p><div className="text-xs md:text-sm mt-1 font-bold text-pastel-blue-400">Selecionado: {currentSelections.length} / {getSelectionLimit()}</div></div><div className="flex flex-col items-center min-w-[60px]"><span className="text-3xl md:text-4xl">{timerEmoji}</span><span className={`text-xl md:text-2xl font-bold ${timer <= 6 ? 'text-red-500' : 'text-pastel-blue-500'}`}>{timer}s</span></div></div><div className="flex-1 overflow-y-auto p-2 md:p-6 custom-scroll min-h-0 flex items-center justify-center"><div className={`grid gap-2 md:gap-4 w-full ${phaseOptions.length > 6 ? 'grid-cols-3 md:grid-cols-3' : 'grid-cols-2 md:grid-cols-3'}`}>{phaseOptions.map((ing, idx) => { const count = currentSelections.filter(i => i === ing).length; return (<button key={idx} onClick={() => handleSelection(ing)} className={`relative p-2 md:p-4 rounded-lg md:rounded-xl font-bold text-xs md:text-sm transition-all active:scale-95 flex items-center justify-center text-center h-24 md:h-32 shadow-sm break-words leading-tight animate-fade-in bg-white text-slate-700 border-2 border-pastel-blue-200 hover:border-pastel-blue-400 shadow-md hover:shadow-lg`}>{ing}{count > 0 && <span className="absolute -top-2 -right-2 bg-pastel-blue-500 text-white text-xs w-6 h-6 flex items-center justify-center rounded-full border-2 border-white shadow-md z-10">{count}</span>}</button>)})}</div></div><div className="p-3 md:p-4 border-t border-pastel-blue-200/50 bg-pastel-blue-100/40 flex justify-between shrink-0"><button onClick={resetToHome} className="flex items-center gap-2 text-pastel-blue-500 font-bold text-sm md:text-base hover:bg-pastel-blue-100/50 px-3 py-2 rounded-lg transition-colors"><IconHome size={20} color="#404FC2"/> INÃCIO</button><button onClick={handleUndo} disabled={currentSelections.length === 0} className="flex items-center gap-2 px-4 md:px-6 py-2 bg-white border border-pastel-blue-200 rounded-full font-bold text-pastel-blue-500 disabled:opacity-50 hover:bg-pastel-blue-100 text-sm md:text-base shadow-sm"><IconArrowLeft size={20} color="#404FC2"/> Desfazer</button></div></div> )}

                        {gameState === "RESULT_SUCCESS" && ( <div className="text-center p-10 bg-pastel-blue-100/95 rounded-3xl shadow-2xl animate-bounce-in mx-4 border border-white/50 max-w-md w-full"><h2 className="text-3xl md:text-4xl font-extrabold text-blue-500 mb-6 drop-shadow-sm flex items-center justify-center gap-2"><IconCheck size={40} /> PARABÃ‰NS!</h2><p className="text-slate-600 mb-8 font-medium text-xl">{resultMessage}</p><button onClick={resetToHome} className="mt-4 bg-pastel-blue-500 text-white px-8 py-4 rounded-full font-bold text-lg shadow-lg hover:bg-pastel-blue-400 transition-all active:scale-95 flex items-center justify-center gap-2 w-full"><IconHome size={24}/> Voltar ao InÃ­cio</button></div> )}
                        {gameState === "RESULT_FAIL" && ( <div className="text-center p-6 md:p-10 bg-pastel-blue-100/95 rounded-3xl shadow-2xl animate-shake mx-4 max-h-[80vh] overflow-y-auto custom-scroll border border-white/50"><h2 className="text-2xl md:text-3xl font-extrabold text-pastel-pink-500 mb-4">EPA! ðŸ˜Ÿ</h2><p className="text-base md:text-lg text-slate-700 mb-6">{resultMessage}</p><div className="bg-white/60 p-4 rounded-lg text-left text-sm text-pastel-pink-500 mb-6 border border-pastel-pink-200">{errorDetails.map((e, i) => <div key={i} className="mb-1">â€¢ {e}</div>)}</div><button onClick={resetToHome} className="bg-pastel-blue-500 text-white px-8 py-3 rounded-full font-bold shadow-lg hover:bg-pastel-blue-400 transition-transform active:scale-95 flex items-center justify-center gap-2 mx-auto"><IconRotate size={20} color="#FFF"/> Tentar Novamente</button></div> )}
                        {gameState === "HOME" && ( <div className="hidden md:flex flex-col items-center justify-center text-center bg-pastel-blue-100/40 p-10 rounded-3xl backdrop-blur-sm shadow-xl max-w-lg"><img src="https://storage.googleapis.com/ikona-bucket-production/images/5db193be3ea71a0001bb09f7/EXTENDED%20VERSION_original%20colors-617ac363073e550017b9966b.png" alt="Poke House Logo" className="h-20 mb-6 object-contain" /><p className="text-pastel-blue-500 font-bold text-2xl mb-4">Bem-vindo ao Treino Poke House!</p><p className="text-slate-700 mb-6">Selecione uma categoria no menu para comeÃ§ar seu treinamento.</p><div className="mt-4 text-6xl animate-bounce">ðŸ¥—</div></div> )}
                    </div>
                    
                    <div className="fixed bottom-1 right-2 z-50"><button onClick={() => setShowChangelog(true)} className="text-xs text-slate-500/60 font-sans hover:text-pastel-blue-500 hover:underline transition-colors select-none">v4.05 BETA</button></div>
                    {showChangelog && <ChangelogModal onClose={() => setShowChangelog(false)} />}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById("root"));
        root.render(<App />);
    </script>
</body>
</html>
